import{W as Ke,X as _t,Y as ft,g as W,o as De,Z as Qe,$ as ht,b as m,h as y,i as a,d as o,w as l,l as x,e as Me,a0 as vt,a1 as gt,a2 as wt,a3 as yt,a4 as Ct,a5 as kt,a6 as xt,a7 as bt,a8 as St,a9 as Ye,aa as Tt,ab as zt,ac as Lt,ad as Wt,ae as Te,af as ze,f as _,ag as Le,ah as Dt,ai as Mt,aj as Vt,ak as Ft,al as jt,am as Pt,an as Ot,ao as Et,ap as Ht,aq as Xe,ar as Ze,P as It,as as $e,at as At,C as qt,t as u,F as E,j as A,U as Rt,au as Bt,av as Ut,aw as Gt,ax as Nt,ay as Qt,az as Yt,aA as Xt,aB as Zt,aC as B,aD as Jt,n as We,aE as Kt,aF as $t,G as eo,E as X,c as ce,aG as to,k as qe,aH as Je,m as fe}from"./vendor-CyP8QNv9.js";import{_ as Re}from"./index-DG4bgh5S.js";import"./request-DTHdL8ze.js";const oo={name:"CampusMap3D",components:{Plus:Ke,Minus:_t,Switch:ft},props:{canteens:{type:Array,required:!0}},emits:["select-canteen"],setup(H,{emit:n}){const h=W(null);let e,v,b,r,f=[];new Le(0,50,50);let k=0,O=0,j=!1;const N=new Dt,Q=new Mt,g=W(!1),q={中央食堂:{floors:[{name:"一楼",sections:[{name:"左区",desc:"特色炒菜、面食、盖浇饭"},{name:"右区",desc:"自选菜品、米饭窗口"}]},{name:"二楼",sections:[{name:"左区",desc:"特色小炒、面食"},{name:"右区",desc:"自选菜品"},{name:"教工食堂",desc:"教职工专用餐区"}]}]},沁园餐厅:{floors:[{name:"一楼",desc:"学生餐厅，提供各类炒菜、面食"},{name:"二楼",desc:"教工食堂，环境优雅，菜品丰富"}]},馨园餐厅:{desc:"位于教学区，提供快餐、面食等，环境舒适"},A区餐饮服务点:{desc:"便利的小型餐饮点，提供简餐、饮品和小吃"},仲园餐厅:{floors:[{name:"一楼",desc:"提供各类炒菜、面食、特色小吃"},{name:"二楼",desc:"自助餐区，菜品种类丰富"}]},F区餐饮服务点:{desc:"便捷的餐饮服务点，提供快餐和饮品"},雅园餐厅:{desc:"环境优美的餐厅，提供特色菜品和西式简餐"}},he=(d,w)=>{const C=[];C.push(new Le(d.x,2,d.z)),C.push(new Le(d.x+2,4,d.z)),C.push(new Le(d.x+5,4,d.z));const z=new Vt().setFromPoints(C),S=new Ft({color:16777215}),L=new jt(z,S),p=(T,M=0)=>{const I=document.createElement("canvas"),Y=I.getContext("2d");I.width=512,I.height=256,Y.font="bold 28px Arial",Y.fillStyle="white",Y.textAlign="left",Y.textBaseline="middle";const Ve=(G,we,me,be,Ee,ye)=>{const Ce=we.split("");let ne="",_e=be;for(let le=0;le<Ce.length;le++){const Se=ne+Ce[le];G.measureText(Se).width>Ee&&le>0?(G.fillText(ne,me,_e),ne=Ce[le],_e+=ye):ne=Se}return G.fillText(ne,me,_e),_e},Fe=T.split(`
`);let xe=25;const ge=35,je=I.width-40;Fe.forEach(G=>{xe=Ve(Y,G,20,xe,je,ge)+ge});const Pe=new Xe(I),Oe=new Ze({map:Pe,transparent:!0}),D=new ze(Oe);return D.position.set(d.x+8,4-M*.8,d.z),D.scale.set(12,6,1),D},s=[];return w.floors?w.floors.forEach((T,M)=>{let I=`${T.name}
`;T.sections?T.sections.forEach(Y=>{I+=`${Y.name}：${Y.desc}
`}):I+=T.desc,s.push(p(I,M*4))}):s.push(p(w.desc)),{line:L,infoSprites:s}},K=()=>{g.value=!1,r.enabled=!0,r.enablePan=!0,r.enableZoom=!0,r.enableRotate=!0,r.minDistance=10,r.maxDistance=150,r.minPolarAngle=0,r.maxPolarAngle=Math.PI*.85,ue(),v.position.set(0,25,35),r.target.set(0,0,0),v.lookAt(0,0,0),r.update(),b.render(e,v),f.forEach(d=>{d.data.infoObjects&&(d.data.infoObjects.forEach(w=>{e.remove(w)}),delete d.data.infoObjects)})},$=()=>{e=new vt,v=new gt(75,h.value.clientWidth/h.value.clientHeight,.1,1e3),b=new wt({antialias:!0,alpha:!0,powerPreference:"high-performance",canvas:h.value.querySelector("canvas")||void 0}),b.setPixelRatio(window.devicePixelRatio),b.setSize(h.value.clientWidth,h.value.clientHeight),b.shadowMap.enabled=!0,b.shadowMap.type=yt,h.value.querySelector("canvas")||h.value.appendChild(b.domElement);const d=new Ct(16777215,.6);e.add(d);const w=new kt(16777215,.8);w.position.set(0,10,0),e.add(w);const C=new xt().load(["/assets/skybox/px.jpg","/assets/skybox/nx.jpg","/assets/skybox/py.jpg","/assets/skybox/ny.jpg","/assets/skybox/pz.jpg","/assets/skybox/nz.jpg"]);e.background=C,r=new bt(v,b.domElement),r.enableDamping=!0,r.dampingFactor=.05,r.enableRotate=!0,r.enablePan=!0,r.enableZoom=!0,r.rotateSpeed=.5,r.panSpeed=.5,r.zoomSpeed=.5,r.minDistance=10,r.maxDistance=150,r.maxPolarAngle=Math.PI*.85,v.position.set(0,25,35),v.lookAt(0,0,0);const S=new St().load("http://192.168.192.101:9000/canteen/3D%E5%B9%B3%E9%9D%A2%E5%9C%B0%E6%9D%BF.jpg");S.wrapS=Ye,S.wrapT=Ye,S.repeat.set(1,1),S.magFilter=Tt,S.minFilter=zt,S.anisotropy=b.capabilities.getMaxAnisotropy();const L=new Lt({map:S,roughness:.7,metalness:.1,color:13421772}),p=new Wt(100,100),s=new Te(p,L);s.rotation.x=-Math.PI/2,s.position.y=0,s.receiveShadow=!0,e.add(s),Z(),U()},ee=d=>{const w=document.createElement("canvas"),C=w.getContext("2d");w.width=256,w.height=128,C.font="Bold 40px Arial",C.fillStyle="white",C.textAlign="center",C.textBaseline="middle",C.fillStyle="white",C.fillText(d,w.width/2,w.height/2);const z=new Xe(w),S=new Ze({map:z,transparent:!0}),L=new ze(S);return L.scale.set(10,5,1),L},V=d=>{const w=new Pt(.7,.7,4,32),C=new Ot({color:d.color,shininess:100,emissive:d.color,emissiveIntensity:.2}),z=new Te(w,C),S=new Et(1.2,32,32),L=new Ht({color:d.color,transparent:!0,opacity:.3}),p=new Te(S,L);z.add(p),z.position.set(d.position.x,2,d.position.z),z.onBeforeRender=()=>{p.scale.setScalar(1+Math.sin(Date.now()*.003)*.1)};const s=ee(d.name);return s.position.set(d.position.x,6,d.position.z+2),z.userData=d,s.userData=d,{marker:z,textMesh:s}},Z=()=>{[{id:1,name:"中央食堂",position:{x:-5,z:-20},color:16711680},{id:2,name:"沁园餐厅",position:{x:2,z:-20},color:65280},{id:3,name:"馨园餐厅",position:{x:-7,z:-22},color:255},{id:4,name:"A区餐饮服务点",position:{x:-10,z:-30},color:16776960},{id:5,name:"仲园餐厅",position:{x:-32,z:-3},color:16711935},{id:6,name:"F区餐饮服务点",position:{x:-28,z:8},color:65535},{id:7,name:"雅园餐厅",position:{x:-14,z:12},color:16753920}].forEach(w=>{const{marker:C,textMesh:z}=V(w);e.add(C),e.add(z),f.push({mesh:C,data:w}),C.userData=w,C.callback=J,C.callbackTarget=C})},J=d=>{n("select-canteen",d)},U=()=>{!b||!e||!v||(requestAnimationFrame(U),r&&r.update(),b.render(e,v))},te=()=>{v&&b&&h.value&&(v.aspect=h.value.clientWidth/h.value.clientHeight,v.updateProjectionMatrix(),b.setSize(h.value.clientWidth,h.value.clientHeight))},oe=()=>{v.position.y*=.8,v.position.z*=.8},ve=()=>{v.position.y*=1.2,v.position.z*=1.2},ae=d=>{switch(v.position.clone(),d){case"up":v.position.z-=10;break;case"down":v.position.z+=10;break;case"left":v.position.x-=10;break;case"right":v.position.x+=10;break}v.lookAt(0,0,0),r.update()},re=d=>{if(!j||d.touches.length!==1)return;const w=.3,C=d.touches[0].clientX,z=d.touches[0].clientY,S=(C-k)*w,L=(z-O)*w,p=.95;v.position.x-=S*p,v.position.z+=L*p,k=C,O=z,r.update()},de=d=>{d.touches.length===2?Math.hypot(d.touches[0].clientX-d.touches[1].clientX,d.touches[0].clientY-d.touches[1].clientY):(j=!0,k=d.touches[0].clientX,O=d.touches[0].clientY)},se=()=>{j=!1},ue=(d=null)=>{f.forEach(w=>{const C=w.mesh,z=e.children.find(S=>S instanceof ze&&S.userData.id===w.data.id);if(d){const S=w.data.id===d.id;C.visible=S,z&&(z.visible=S)}else C.visible=!0,z&&(z.visible=!0)})},pe=d=>{const w=b.domElement.getBoundingClientRect();Q.x=(d.clientX-w.left)/w.width*2-1,Q.y=-((d.clientY-w.top)/w.height)*2+1,N.setFromCamera(Q,v);const C=[];e.traverse(S=>{(S instanceof Te||S instanceof ze)&&C.push(S)});const z=N.intersectObjects(C);if(z.length>0){const L=z[0].object.userData;if(L&&L.position){g.value=!0,r.enabled=!0,r.target.set(L.position.x,0,L.position.z),r.enablePan=!0,r.enableZoom=!0,r.enableRotate=!0,r.minDistance=5,r.maxDistance=50,r.minPolarAngle=0,r.maxPolarAngle=Math.PI,ue(L),n("select-canteen",L);const p=q[L.name];if(p){const{line:s,infoSprites:T}=he(L.position,p);e.add(s),T.forEach(M=>e.add(M)),L.infoObjects=[s,...T]}}}};return De(()=>{if(console.log("CampusMap3D mounted"),console.log("Container:",h.value),console.log("Canteens:",H.canteens),!Qe.isWebGL2Available()){console.error("WebGL 2 is not available");const d=Qe.getWebGL2ErrorMessage();h.value.appendChild(d);return}h.value&&($(),window.addEventListener("resize",te),h.value&&(h.value.addEventListener("touchstart",de,{passive:!0}),h.value.addEventListener("touchmove",re,{passive:!0}),h.value.addEventListener("touchend",se,{passive:!0}),h.value.addEventListener("click",pe)))}),ht(()=>{window.removeEventListener("resize",te),b&&(b.dispose(),b.forceContextLoss(),b=null),e&&(e.clear(),e=null),r&&(r.dispose(),r=null),v=null,h.value&&(h.value.removeEventListener("touchstart",de),h.value.removeEventListener("touchmove",re),h.value.removeEventListener("touchend",se),h.value.removeEventListener("click",pe))}),{mapContainer:h,zoomIn:oe,zoomOut:ve,moveCamera:ae,isLocked:g,unlockView:K}}},ao={class:"campus-map"},so={id:"map-container",ref:"mapContainer"},no={key:0,class:"unlock-control"},lo={class:"map-controls"};function io(H,n,h,e,v,b){const r=_("Switch"),f=_("el-icon"),k=_("el-button"),O=_("Plus"),j=_("Minus"),N=_("el-button-group");return m(),y("div",ao,[a("div",so,null,512),e.isLocked?(m(),y("div",no,[o(k,{size:"small",type:"primary",onClick:e.unlockView},{default:l(()=>[o(f,null,{default:l(()=>[o(r)]),_:1}),n[0]||(n[0]=x(" 自由视角 "))]),_:1},8,["onClick"])])):Me("",!0),a("div",lo,[o(N,null,{default:l(()=>[o(k,{size:"small",onClick:e.zoomIn},{default:l(()=>[o(f,null,{default:l(()=>[o(O)]),_:1})]),_:1},8,["onClick"]),o(k,{size:"small",onClick:e.zoomOut},{default:l(()=>[o(f,null,{default:l(()=>[o(j)]),_:1})]),_:1},8,["onClick"])]),_:1})])])}const co=Re(oo,[["render",io],["__scopeId","data-v-d43b7734"]]),ro={name:"CanteenTrafficMonitor",components:{User:It,Timer:$e,Refresh:At},setup(){const H=W([]),n=W(""),h=W(!1),e=W(null);let v=null;const b=O=>{const j={low:{type:"success",text:"空闲",color:"#67C23A"},medium:{type:"warning",text:"较忙",color:"#E6A23C"},high:{type:"danger",text:"拥挤",color:"#F56C6C"}};return j[O]||j.low},r=()=>{n.value=Bt().format("HH:mm:ss")},f=async()=>{H.value=[{id:1,name:"中央食堂",crowdLevel:"medium",currentCount:320,capacity:500,avgWaitTime:8,floors:[{id:1,name:"一楼",windows:[{id:1,name:"特色炒菜",crowdLevel:"high",waitTime:10},{id:2,name:"面食档口",crowdLevel:"low",waitTime:3}]},{id:2,name:"二楼",windows:[{id:3,name:"自选档口",crowdLevel:"medium",waitTime:5},{id:4,name:"盖浇饭",crowdLevel:"low",waitTime:2}]}]}]},k=O=>{e.value=O,h.value=!0};return De(()=>{f(),r(),v=setInterval(()=>{r(),f()},3e4)}),qt(()=>{v&&clearInterval(v)}),{trafficData:H,currentTime:n,dialogVisible:h,selectedCanteen:e,getTrafficLevel:b,refreshData:f,showDetail:k}}},uo={class:"traffic-monitor"},po={class:"monitor-header"},mo={class:"traffic-cards"},_o=["onClick"],fo={class:"card-header"},ho={class:"canteen-name"},vo={class:"traffic-info"},go={class:"info-item"},wo={class:"info-item"},yo={class:"traffic-chart"},Co={class:"progress-bar"},ko={class:"capacity-text"},xo={key:0,class:"detail-content"},bo={class:"floor-list"},So={class:"window-list"},To={class:"window-name"},zo={class:"window-status"},Lo={class:"wait-time"};function Wo(H,n,h,e,v,b){var Q;const r=_("Refresh"),f=_("el-icon"),k=_("el-tag"),O=_("User"),j=_("Timer"),N=_("el-dialog");return m(),y("div",uo,[a("div",po,[n[1]||(n[1]=a("h4",null,"实时客流",-1)),o(k,{size:"small",type:"info"},{default:l(()=>[x(u(e.currentTime)+" ",1),o(f,{class:"refresh-icon",onClick:e.refreshData},{default:l(()=>[o(r)]),_:1},8,["onClick"])]),_:1})]),a("div",mo,[(m(!0),y(E,null,A(e.trafficData,g=>(m(),y("div",{key:g.id,class:"traffic-card",onClick:q=>e.showDetail(g)},[a("div",fo,[a("span",ho,u(g.name),1),o(k,{type:e.getTrafficLevel(g.crowdLevel).type,size:"small"},{default:l(()=>[x(u(e.getTrafficLevel(g.crowdLevel).text),1)]),_:2},1032,["type"])]),a("div",vo,[a("div",go,[o(f,null,{default:l(()=>[o(O)]),_:1}),a("span",null,"当前人数: "+u(g.currentCount)+"人",1)]),a("div",wo,[o(f,null,{default:l(()=>[o(j)]),_:1}),a("span",null,"平均等待: "+u(g.avgWaitTime)+"分钟",1)])]),a("div",yo,[a("div",Co,[a("div",{class:"progress",style:Rt({width:`${g.currentCount/g.capacity*100}%`,backgroundColor:e.getTrafficLevel(g.crowdLevel).color})},null,4)]),a("span",ko,"容量: "+u(g.currentCount)+"/"+u(g.capacity),1)])],8,_o))),128))]),o(N,{modelValue:e.dialogVisible,"onUpdate:modelValue":n[0]||(n[0]=g=>e.dialogVisible=g),title:((Q=e.selectedCanteen)==null?void 0:Q.name)+" - 实时状况",width:"90%"},{default:l(()=>[e.selectedCanteen?(m(),y("div",xo,[a("div",bo,[(m(!0),y(E,null,A(e.selectedCanteen.floors,g=>(m(),y("div",{key:g.id,class:"floor-item"},[a("h5",null,u(g.name),1),a("div",So,[(m(!0),y(E,null,A(g.windows,q=>(m(),y("div",{key:q.id,class:"window-item"},[a("span",To,u(q.name),1),a("div",zo,[o(k,{type:e.getTrafficLevel(q.crowdLevel).type,size:"small"},{default:l(()=>[x(u(e.getTrafficLevel(q.crowdLevel).text),1)]),_:2},1032,["type"]),a("span",Lo,"等待"+u(q.waitTime)+"分钟",1)])]))),128))])]))),128))])])):Me("",!0)]),_:1},8,["modelValue","title"])])}const Do=Re(ro,[["render",Wo],["__scopeId","data-v-d6b2742b"]]),Mo={name:"DishList",components:{Location:Ut,Timer:$e,Position:Gt,Picture:Nt,Search:Qt,Plus:Ke,ShoppingCart:Yt,CircleCheck:Xt,CircleClose:Zt,CampusMap3D:co,CanteenTrafficMonitor:Do},setup(){const H=eo(),n=W("中央食堂"),h=W(null),e=W(null),v=W(""),b=W(""),r=W(""),f=W(""),k=W([]),O=fe("isCanteenOpen"),j=fe("getFloorWindows"),N=fe("isWindowOpen"),Q=fe("getCrowdLevelType"),g=fe("getCrowdLevelText"),q=fe("getWindowDishCount"),he=t=>N(t),K=t=>O(t),$=t=>Q(t),ee=t=>g(t),V=t=>q(t),Z=(t,i)=>j(t,i),J=[{id:1,name:"中央食堂",floors:3,location:"校园中心区"},{id:2,name:"沁园餐厅",floors:2,location:"学生宿舍区"},{id:3,name:"馨园餐厅",floors:1,location:"教学区"},{id:4,name:"仲园餐厅",floors:2,location:"图书馆附近"},{id:5,name:"雅园餐厅",floors:1,location:"体馆附近"},{id:6,name:"F服务点",floors:1,location:"F区教学楼"},{id:7,name:"A区服务点",floors:1,location:"A区教学楼"}],U={中央食堂:{1:[{id:1,name:"川湘",operatingHours:"10:30-13:30, 16:30-19:00",status:"open",image_url:"https://example.com/window1.jpg",description:"正宗川湘菜系，提供各类特色炒菜、川味小炒"},{id:2,name:"粤式炖汤",operatingHours:"10:30-13:30",status:"closed",image_url:"https://example.com/window2.jpg",description:"每日新鲜炖汤，滋补养生"},{id:3,name:"新疆风味",operatingHours:"10:30-19:00",status:"open",image_url:"https://example.com/window3.jpg",description:"地道新疆美食，大盘鸡、手抓饭"},{id:4,name:"面食档口",operatingHours:"10:30-19:00",status:"open",image_url:"https://example.com/window4.jpg",description:"各式面食，现煮现卖"},{id:5,name:"米饭窗口",operatingHours:"10:30-13:30, 16:30-19:00",status:"open",image_url:"https://example.com/window5.jpg",description:"提供各类盖浇饭、套餐"}],2:[{id:6,name:"特色小炒",operatingHours:"10:30-19:00",status:"open",image_url:"https://example.com/window6.jpg",description:"现炒菜品，可自选搭配"},{id:7,name:"清真窗口",operatingHours:"10:30-19:00",status:"open",image_url:"https://example.com/window7.jpg",description:"提供清真认证的美食"},{id:8,name:"东北菜",operatingHours:"10:30-19:00",status:"open",image_url:"https://example.com/window8.jpg",description:"东北特色菜品，份量惠"},{id:9,name:"快餐套餐",operatingHours:"10:30-19:00",status:"open",image_url:"https://example.com/window9.jpg",description:"经济实惠的快餐套餐"}],3:[{id:10,name:"火锅窗口",operatingHours:"10:30-19:00",status:"open",image_url:"https://example.com/window10.jpg",description:"自选火锅，多种口味"},{id:11,name:"饮品店",operatingHours:"08:30-20:00",status:"open",image_url:"https://example.com/window11.jpg",description:"奶茶、果汁、咖啡"},{id:12,name:"水果店",operatingHours:"08:30-20:00",status:"open",image_url:"https://example.com/window12.jpg",description:"新鲜水果，每日配送"}]},沁园餐厅:{1:[{id:13,name:"自选快餐",operatingHours:"10:30-19:00",status:"open",image_url:"https://example.com/window13.jpg",description:"自选菜品，搭配更自由"},{id:14,name:"面食档口",operatingHours:"10:30-19:00",status:"open",image_url:"https://example.com/window14.jpg",description:"各式面食，现做现卖"},{id:15,name:"饮品店",operatingHours:"08:30-20:00",status:"open",image_url:"https://example.com/window15.jpg",description:"饮品甜点，解暑解馋"}],2:[{id:16,name:"特色炒菜",operatingHours:"10:30-19:00",status:"open",image_url:"https://example.com/window16.jpg",description:"各式炒菜，可自选搭配"},{id:17,name:"盖浇饭",operatingHours:"10:30-19:00",status:"open",image_url:"https://example.com/window17.jpg",description:"多种盖浇饭，经济实惠"}]}},te={1:[{id:1,name:"麻婆豆腐",price:12,description:"使用四川特制豆瓣酱，口感麻辣鲜香",category:"川菜",taste:"spicy",image_url:"https://example.com/mapo-tofu.jpg",stock:20,weekSales:156},{id:2,name:"水煮肉片",price:22,description:"新鲜猪肉，麻辣鲜香",category:"川菜",taste:"spicy",image_url:"https://example.com/shuizhu.jpg",stock:15,weekSales:90},{id:3,name:"回锅肉",price:18,description:"传统式回锅肉",category:"川菜",taste:"savory",image_url:"https://example.com/huiguo.jpg",stock:25,weekSales:80}],2:[{id:4,name:"莲藕排骨汤",price:16,description:"清甜可口，营养丰富",category:"粤菜",taste:"light",image_url:"https://example.com/soup.jpg",stock:10,weekSales:70},{id:5,name:"海鲜汤",price:20,description:"新鲜海鲜熬制",category:"粤菜",taste:"light",image_url:"https://example.com/seafood-soup.jpg",stock:8,weekSales:60}],4:[{id:6,name:"番茄牛肉面",price:15,description:"手工面条，配以新鲜番茄和优质牛肉",category:"面食",taste:"savory",image_url:"https://example.com/beef-noodles.jpg",stock:30,weekSales:50},{id:7,name:"担担面",price:12,description:"正宗川式面，香辣可口",category:"面食",taste:"spicy",image_url:"https://example.com/dandanmian.jpg",stock:25,weekSales:40},{id:8,name:"阳春面",price:8,description:"简单美味",category:"面食",taste:"light",image_url:"https://example.com/yangchun.jpg",stock:40,weekSales:30}],6:[{id:9,name:"宫保鸡丁",price:16,description:"经典川菜",category:"川",taste:"spicy",image_url:"https://example.com/gongbao.jpg",stock:20,weekSales:20},{id:10,name:"糖醋里脊",price:18,description:"酸甜可口",category:"本帮菜",taste:"sweet",image_url:"https://example.com/tangcu.jpg",stock:15,weekSales:15}],11:[{id:11,name:"珍珠奶茶",price:8,description:"香浓奶茶",category:"饮品",taste:"sweet",image_url:"https://example.com/milk-tea.jpg",stock:50,weekSales:50},{id:12,name:"柠檬水",price:6,description:"清爽解暑",category:"饮品",taste:"sweet",image_url:"https://example.com/lemon.jpg",stock:40,weekSales:40}]},oe=["川菜","本帮","粤菜","面食","素菜","饮品"],ve=t=>({川菜:"danger",本帮菜:"warning",粤菜:"success",面食:"primary",素菜:"info",饮品:"info"})[t]||"info",ae=t=>{n.value=t.props.name,h.value=null,e.value=null,T.value=1},re=W([{id:1,name:"中央食堂",position:{x:-20,z:-20},location:"校园中心区"},{id:2,name:"沁园餐厅",position:{x:20,z:20},location:"学生宿舍区"},{id:3,name:"馨园餐厅",position:{x:0,z:-30},location:"央食堂附"},{id:4,name:"仲园餐厅",position:{x:-30,z:0},location:"D区附近"},{id:5,name:"雅园餐厅",position:{x:30,z:-20},location:"信科附近"},{id:6,name:"F区服务点",position:{x:10,z:-10},location:"F区宿舍"},{id:7,name:"A区服务点",position:{x:-10,z:10},location:"A区宿舍"}]),de=t=>{n.value=t.name;const i={props:{name:t.name}};ae(i)},se=async t=>{e.value=t,t?await ue(t.id):k.value=[]},ue=async t=>{try{return k.value=te[t]||[],k.value.length===0&&X.info("该窗口暂无菜品信息"),k.value}catch(i){return console.error("加载菜品列表失败:",i),X.error("加载菜品列表失败"),k.value=[],[]}},pe=t=>{H.push(`/student/dishes/${t.id}`)},d=t=>{H.push(`/student/dishes/${t.id}`)},w=[{label:"麻辣",value:"spicy"},{label:"清淡",value:"light"},{label:"酸甜",value:"sweet"},{label:"咸鲜",value:"savory"}],C=()=>{if(!v.value.trim()){X.warning("请输入搜索关键词");return}X.success(`正在搜索: ${v.value}`)},z=()=>{},S=()=>{(!f.value||f.value==="default")&&(He.value=[...He.value].sort(()=>Math.random()-.5))},L=()=>{},p=()=>{v.value="",b.value="",r.value="",f.value="",ie.value=""},s=B(()=>{let t=k.value;if(b.value){const i=b.value.toLowerCase();t=t.filter(c=>c.name.toLowerCase().includes(i)||c.description.toLowerCase().includes(i))}return r.value&&(t=t.filter(i=>i.taste===r.value)),ie.value&&(t=t.filter(i=>i.category===ie.value)),f.value&&(t=[...t].sort((i,c)=>{switch(f.value){case"price-asc":return i.price-c.price;case"price-desc":return c.price-i.price;case"sales":return(c.sales||0)-(i.sales||0);default:return 0}})),t}),T=W(1),M=W(8),I=B(()=>(j(n.value,h.value)||[]).length),Y=B(()=>Math.ceil(I.value/M.value)),Ve=B(()=>{const t=j(n.value,h.value)||[],i=(T.value-1)*M.value;return t.slice(i,i+M.value)}),Fe=t=>{T.value=t},xe=t=>{h.value===t?(h.value=null,e.value=null):(h.value=t,e.value=null),T.value=1},ge=()=>{const t=document.querySelector(".dishes-list"),i={activeCanteen:n.value,selectedFloor:h.value,selectedWindow:e.value?{id:e.value.id,name:e.value.name,operatingHours:e.value.operatingHours,status:e.value.status}:null,searchQuery:v.value,windowSearchQuery:b.value,selectedTaste:r.value,scrollPosition:(t==null?void 0:t.scrollTop)||0,scrollHeight:(t==null?void 0:t.scrollHeight)||0,scrollWidth:(t==null?void 0:t.scrollWidth)||0,clientHeight:(t==null?void 0:t.clientHeight)||0};localStorage.setItem("dishListState",JSON.stringify(i))},je=t=>{ge(),H.push(`/student/dishes/${t}`)},Pe=t=>({spicy:"麻辣",light:"清淡",sweet:"甜味",savory:"咸鲜"})[t]||t,Oe=t=>({spicy:"danger",light:"info",sweet:"warning",savory:"success"})[t]||"",D=W({}),G=W(!1),we=W(!1),me=W(null),be=Jt({diningTime:"",diningType:"dine_in",remark:""}),Ee={diningTime:[{required:!0,message:"请选择就餐时间",trigger:"change"}],diningType:[{required:!0,message:"请选择就餐方式",trigger:"change"}]},ye=B(()=>{var i;const t=(i=e.value)==null?void 0:i.id;return t?D.value[t]||[]:Object.values(D.value).flat()}),Ce=B(()=>ye.value.reduce((t,i)=>t+i.price*i.quantity,0)),ne=B(()=>ye.value.reduce((t,i)=>t+i.quantity,0)),_e=async t=>{var i;try{event.stopPropagation();const c=((i=e.value)==null?void 0:i.id)||t.windowId;D.value[c]||(D.value[c]=[]);const P=D.value[c],F=P.find(R=>R.id===t.id);F?F.quantity++:P.push({...t,windowId:c,quantity:1}),localStorage.setItem("cartData",JSON.stringify(D.value)),X.success("已加到购物车")}catch(c){console.error("添加购物车失败:",c),X.error("添加购物车失败")}},le=(t,i)=>{t.quantity===0&&(D.value[i]=D.value[i].filter(c=>c.id!==t.id),D.value[i].length===0&&delete D.value[i])},Se=()=>{G.value=!0},Be=t=>{G.value=!1,we.value=!0,Ge.value=t},Ue=async()=>{var t;if(me.value)try{await me.value.validate();const i=(t=e.value)==null?void 0:t.id;if(!i||!D.value[i])throw new Error("购物车数据无效");const c={windowId:i,items:D.value[i],...be};X.success("下单成功"),we.value=!1,D.value[i]=[],H.push("/student/orders")}catch(i){console.error("下单失败:",i),X.error("下单失败")}},et=B(()=>({position:"fixed",left:"135px",right:"50px",bottom:"60px",background:"#fff",padding:"15px 20px",borderRadius:"8px",boxShadow:"0 2px 12px rgba(0, 0, 0, 0.1)",zIndex:1e3})),Ge=W(null),tt=async()=>{const t=localStorage.getItem("dishListState"),i=localStorage.getItem("isReturningFromDetail");if(t&&i==="true")try{const c=JSON.parse(t);if(n.value=c.activeCanteen,await We(),c.selectedFloor&&(h.value=c.selectedFloor,await We(),c.selectedWindow)){const F=j(c.activeCanteen,c.selectedFloor).find(R=>R.id===c.selectedWindow.id);if(F){await se(F),await We(),await new Promise(ke=>setTimeout(ke,200));const R=document.querySelector(".dishes-list");if(R){const ke=R.scrollHeight-R.clientHeight,Ae=Math.min(c.scrollPosition,ke);R.scrollTop=Ae}}}v.value=c.searchQuery,b.value=c.windowSearchQuery,r.value=c.selectedTaste,f.value=c.priceSort,localStorage.removeItem("isReturningFromDetail"),localStorage.removeItem("dishListState")}catch(c){console.error("恢复状态失败:",c)}};De(async()=>{localStorage.getItem("isReturningFromDetail")==="true"&&(await We(),await tt())});const Ne=((t,i)=>{let c=null;return function(...P){c&&clearTimeout(c),c=setTimeout(()=>t.apply(this,P),i)}})(ge,300);De(()=>{const t=document.querySelector(".dishes-list");return t&&t.addEventListener("scroll",Ne),()=>{t&&t.removeEventListener("scroll",Ne)}});const ie=W(""),ot=B(()=>{const t=new Set(k.value.map(i=>i.category));return["全部",...Array.from(t)]}),at=t=>{ie.value=t==="全部"?"":t},st=()=>{D.value={},G.value=!1,X.success("购物车已清空")},He=B(()=>{const t=n.value,i=U[t]||{};let c=[];Object.values(i).forEach(P=>{P.forEach(F=>{const ke=(te[F.id]||[]).map(Ae=>({...Ae,windowName:F.name,windowId:F.id,windowStatus:F.status}));c=[...c,...ke]})});for(let P=c.length-1;P>0;P--){const F=Math.floor(Math.random()*(P+1));[c[P],c[F]]=[c[F],c[P]]}return c}),nt=B(()=>{let t=He.value;if(v.value){const i=v.value.toLowerCase();t=t.filter(c=>c.name.toLowerCase().includes(i)||c.description.toLowerCase().includes(i))}return r.value&&(t=t.filter(i=>i.taste===r.value)),ie.value&&(t=t.filter(i=>i.category===ie.value)),f.value&&(t=[...t].sort((i,c)=>{switch(f.value){case"price-asc":return i.price-c.price;case"price-desc":return c.price-i.price;case"sales-desc":return c.weekSales-i.weekSales;case"sales-asc":return i.weekSales-c.weekSales;default:return 0}})),t}),lt=t=>{const i=n.value,c=U[i]||{};for(const[P,F]of Object.entries(c))if(F.some(R=>R.id===t))return P;return""},it=B(()=>D.value&&Object.values(D.value).some(t=>t.length>0)),ct=B(()=>D.value||{}),rt=t=>{const i=n.value,c=U[i]||{};for(const P of Object.values(c)){const F=P.find(R=>R.id===Number(t));if(F)return F.name}return"未知窗口"},dt=t=>t.reduce((i,c)=>i+c.price*c.quantity,0),ut=t=>t.reduce((i,c)=>i+c.quantity,0),pt=t=>{delete D.value[t],Object.values(D.value).every(i=>i.length===0)&&(G.value=!1),X.success("已清空该窗口购物车")},mt=()=>{H.push("/student/cart")},Ie=W(!0);return{router:H,activeCanteen:n,selectedWindow:e,searchQuery:v,windowSearchQuery:b,selectedTaste:r,tasteOptions:w,canteens:J,isCanteenOpen:K,getFloorWindows:Z,isWindowOpen:he,getCrowdLevelType:$,getCrowdLevelText:ee,getWindowDishCount:V,handleCanteenChange:ae,mapCanteens:re,handleMapCanteenSelect:de,selectWindow:se,showDishDetail:pe,orderDish:d,dishes:k,finalFilteredDishes:s,categories:oe,getCategoryType:ve,selectedFloor:h,toggleFloor:xe,currentPage:T,totalPages:Y,displayWindows:Ve,handlePageChange:Fe,handleSearch:C,handleWindowSearch:z,handleSort:S,handleFilter:L,resetFilters:p,goToDishDetail:je,getTasteLabel:Pe,getTasteTagType:Oe,addToCart:_e,cartItems:ye,cartDrawerVisible:G,checkoutDialogVisible:we,checkoutForm:be,checkoutFormRef:me,checkoutRules:Ee,totalPrice:Ce,totalCount:ne,showCartDetail:Se,handleQuantityChange:le,goToCheckout:Be,submitOrder:Ue,cartStyle:et,currentWindowId:Ge,sortOption:f,selectedCategory:ie,dishCategories:ot,selectCategory:at,clearCart:st,finalFilteredAllDishes:nt,getFloorByWindowId:lt,hasCartItems:it,groupedCartItems:ct,getWindowName:rt,getWindowTotal:dt,getWindowCount:ut,clearWindowCart:pt,goToCart:mt,isMapVisible:Ie,toggleMap:()=>{Ie.value=!Ie.value}}}},Vo={class:"dish-list-container"},Fo={class:"dish-list"},jo={class:"map-toggle"},Po={class:"canteen-nav"},Oo={class:"canteen-header"},Eo={class:"canteen-basic"},Ho={class:"status-tags"},Io={class:"canteen-details"},Ao={class:"filter-controls"},qo={class:"search-container"},Ro={class:"filter-group"},Bo={class:"window-navigation"},Uo={class:"cart-drawer-header"},Go={class:"cart-drawer-content"},No={class:"cart-window-header"},Qo={class:"cart-items-list"},Yo={class:"image-placeholder"},Xo={class:"cart-item-info"},Zo={class:"cart-item-name"},Jo={class:"cart-item-price"},Ko={class:"cart-item-actions"},$o={class:"window-cart-footer"},ea={class:"window-total-info"},ta={class:"total-price"},oa={key:1,class:"empty-cart"},aa={class:"nav-section floor-nav"},sa={class:"nav-list"},na=["onClick"],la={key:0,class:"all-dishes-container"},ia={class:"dishes-grid"},ca=["onClick"],ra={class:"dish-card-content"},da={class:"image-placeholder"},ua={class:"dish-info"},pa={class:"dish-header"},ma={class:"dish-title"},_a={class:"dish-name"},fa={class:"dish-window-info"},ha={class:"dish-description"},va={class:"dish-tags"},ga={class:"dish-footer"},wa={class:"price-info"},ya={class:"price-value"},Ca={key:1,class:"meituan-layout"},ka={class:"window-list"},xa=["onClick"],ba={class:"window-image"},Sa={class:"window-image-placeholder"},Ta={class:"window-info"},za={class:"window-name"},La={class:"window-hours"},Wa={key:0,class:"window-description"},Da={class:"dishes-container"},Ma={class:"dishes-list"},Va={key:0},Fa={class:"window-header"},ja={class:"window-tags"},Pa={class:"window-filter-controls"},Oa={class:"category-nav"},Ea={class:"dishes-grid"},Ha=["onClick"],Ia={class:"dish-card-content"},Aa={class:"image-placeholder"},qa={class:"dish-info"},Ra={class:"dish-header"},Ba={class:"dish-title"},Ua={class:"dish-name"},Ga={class:"dish-window-info"},Na={class:"dish-description"},Qa={class:"dish-tags"},Ya={class:"dish-footer"},Xa={class:"price-info"},Za={class:"price-value"},Ja={key:1,class:"window-closed"},Ka={class:"empty-state-content"},$a={class:"empty-title"},es={class:"empty-status"},ts={class:"empty-hours"},os={key:1,class:"no-window-selected"},as={class:"empty-state-content"},ss={class:"empty-sub-hint"},ns={class:"checkout-content"},ls={class:"checkout-items"},is={class:"item-name"},cs={class:"item-quantity"},rs={class:"item-price"},ds={class:"checkout-form"},us={class:"checkout-total"},ps={class:"total-price"};function ms(H,n,h,e,v,b){const r=_("ShoppingCart"),f=_("el-icon"),k=_("el-button"),O=_("el-badge"),j=_("Location"),N=_("CampusMap3D"),Q=_("CanteenTrafficMonitor"),g=_("el-tag"),q=_("Timer"),he=_("Position"),K=_("el-card"),$=_("Search"),ee=_("el-input"),V=_("el-option"),Z=_("el-select"),J=_("Picture"),U=_("el-image"),te=_("el-input-number"),oe=_("el-empty"),ve=_("el-drawer"),ae=_("Plus"),re=_("CircleCheck"),de=_("CircleClose"),se=_("el-tab-pane"),ue=_("el-tabs"),pe=_("el-divider"),d=_("el-time-select"),w=_("el-form-item"),C=_("el-radio"),z=_("el-radio-group"),S=_("el-form"),L=_("el-dialog");return m(),y("div",Vo,[a("div",Fo,[a("div",{class:"floating-cart-button",onClick:n[0]||(n[0]=(...p)=>e.goToCart&&e.goToCart(...p))},[o(O,{value:e.totalCount,max:99,class:"cart-badge"},{default:l(()=>[o(k,{type:"primary",circle:"",class:"cart-button"},{default:l(()=>[o(f,null,{default:l(()=>[o(r)]),_:1})]),_:1})]),_:1},8,["value"])]),a("div",jo,[o(k,{type:"primary",plain:"",size:"small",onClick:e.toggleMap,class:"toggle-button"},{default:l(()=>[o(f,null,{default:l(()=>[o(j)]),_:1}),x(" "+u(e.isMapVisible?"收起地图":"显示地图"),1)]),_:1},8,["onClick"])]),Kt(o(N,{canteens:e.mapCanteens,onSelectCanteen:e.handleMapCanteenSelect,class:"map-section"},null,8,["canteens","onSelectCanteen"]),[[$t,e.isMapVisible]]),o(Q),a("div",Po,[o(ue,{modelValue:e.activeCanteen,"onUpdate:modelValue":n[9]||(n[9]=p=>e.activeCanteen=p),type:"card",onTabClick:e.handleCanteenChange},{default:l(()=>[(m(!0),y(E,null,A(e.canteens,p=>(m(),ce(se,{key:p.id,label:p.name,name:p.name},{default:l(()=>[o(K,{class:"canteen-info"},{default:l(()=>[a("div",Oo,[a("div",Eo,[a("h3",null,u(p.name),1),a("div",Ho,[o(g,{type:e.isCanteenOpen(p)?"success":"info",size:"small"},{default:l(()=>[x(u(e.isCanteenOpen(p)?"营业中":"已打烊"),1)]),_:2},1032,["type"]),o(g,{type:e.getCrowdLevelType(p.name),size:"small",effect:"dark"},{default:l(()=>[x(u(e.getCrowdLevelText(p.name)),1)]),_:2},1032,["type"])])])]),a("div",Io,[a("p",null,[o(f,null,{default:l(()=>[o(q)]),_:1}),n[15]||(n[15]=x(" 营业时间：10:30-13:30, 16:30-19:00"))]),a("p",null,[o(f,null,{default:l(()=>[o(he)]),_:1}),x(" 位置："+u(p.location),1)])])]),_:2},1024),o(K,{class:"filter-card"},{default:l(()=>[a("div",Ao,[a("div",qo,[o(ee,{modelValue:e.searchQuery,"onUpdate:modelValue":n[1]||(n[1]=s=>e.searchQuery=s),placeholder:"搜索菜品",class:"search-input",clearable:"",onKeyup:to(e.handleSearch,["enter"])},{prefix:l(()=>[o(f,null,{default:l(()=>[o($)]),_:1})]),append:l(()=>[o(k,{type:"primary",onClick:e.handleSearch},{default:l(()=>[o(f,null,{default:l(()=>[o($)]),_:1}),n[16]||(n[16]=x(" 搜索 "))]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeyup"])]),a("div",Ro,[o(Z,{modelValue:e.selectedTaste,"onUpdate:modelValue":n[2]||(n[2]=s=>e.selectedTaste=s),placeholder:"选择口味",clearable:"",class:"filter-item",onChange:e.handleFilter},{default:l(()=>[o(V,{label:"全部口味",value:""}),(m(!0),y(E,null,A(e.tasteOptions,s=>(m(),ce(V,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),o(Z,{modelValue:e.sortOption,"onUpdate:modelValue":n[3]||(n[3]=s=>e.sortOption=s),placeholder:"排序方式",class:"filter-item",onChange:e.handleSort},{default:l(()=>[o(V,{label:"全部",value:""}),o(V,{label:"默认排序",value:"default"}),o(V,{label:"价格从低到高",value:"price-asc"}),o(V,{label:"价格从高到低",value:"price-desc"}),o(V,{label:"销量从高到低",value:"sales-desc"}),o(V,{label:"销量从低到高",value:"sales-asc"})]),_:1},8,["modelValue","onChange"])]),o(k,{type:"primary",onClick:e.resetFilters,class:"filter-item"},{default:l(()=>n[17]||(n[17]=[x(" 重置筛选 ")])),_:1},8,["onClick"])])]),_:1}),a("div",Bo,[o(ve,{modelValue:e.cartDrawerVisible,"onUpdate:modelValue":n[4]||(n[4]=s=>e.cartDrawerVisible=s),title:"购物车",direction:"rtl",size:"380px","show-close":!0,class:"cart-drawer"},{header:l(()=>[a("div",Uo,[n[19]||(n[19]=a("h3",null,"购物车",-1)),e.cartItems.length>0?(m(),ce(k,{key:0,type:"danger",plain:"",size:"small",onClick:e.clearCart},{default:l(()=>n[18]||(n[18]=[x(" 清空购物车 ")])),_:1},8,["onClick"])):Me("",!0)])]),default:l(()=>[a("div",Go,[e.hasCartItems?(m(!0),y(E,{key:0},A(e.groupedCartItems,(s,T)=>(m(),y("div",{key:T,class:"cart-window-group"},[a("div",No,[o(g,{size:"small"},{default:l(()=>[x(u(e.getWindowName(T)),1)]),_:2},1024),o(k,{type:"danger",plain:"",size:"small",onClick:M=>e.clearWindowCart(T)},{default:l(()=>n[20]||(n[20]=[x(" 清空 ")])),_:2},1032,["onClick"])]),a("div",Qo,[(m(!0),y(E,null,A(s,M=>(m(),y("div",{key:M.id,class:"cart-item"},[o(U,{src:M.image_url,class:"cart-item-image",fit:"cover"},{error:l(()=>[a("div",Yo,[o(f,null,{default:l(()=>[o(J)]),_:1})])]),_:2},1032,["src"]),a("div",Xo,[a("div",Zo,u(M.name),1),a("div",Jo,"¥"+u((M.price*M.quantity).toFixed(2)),1)]),a("div",Ko,[o(te,{modelValue:M.quantity,"onUpdate:modelValue":I=>M.quantity=I,min:0,max:M.stock,size:"small",onChange:I=>e.handleQuantityChange(M,T),"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue","max","onChange"])])]))),128)),a("div",$o,[a("div",ea,[n[21]||(n[21]=a("span",{class:"total-label"},"小计:",-1)),a("span",ta,"¥"+u(e.getWindowTotal(s).toFixed(2)),1)]),o(k,{type:"primary",size:"small",onClick:M=>e.goToCheckout(T)},{default:l(()=>[x(" 结算 ("+u(e.getWindowCount(s))+"件) ",1)]),_:2},1032,["onClick"])])])]))),128)):(m(),y("div",oa,[o(oe,{description:"购物车是空的"},{image:l(()=>[o(f,{size:60,class:"empty-cart-icon"},{default:l(()=>[o(r)]),_:1})]),_:1})]))])]),_:1},8,["modelValue"]),a("div",aa,[a("div",sa,[(m(!0),y(E,null,A(p.floors,s=>(m(),y("div",{key:s,class:qe(["nav-item",{active:e.selectedFloor===s}]),onClick:T=>e.toggleFloor(s)},u(s)+"层 ",11,na))),128))])]),e.selectedFloor?(m(),y("div",Ca,[a("div",ka,[(m(!0),y(E,null,A(e.getFloorWindows(e.activeCanteen,e.selectedFloor),s=>{var T;return m(),y("div",{key:s.id,class:qe(["window-item",{active:((T=e.selectedWindow)==null?void 0:T.id)===s.id}]),onClick:M=>e.selectWindow(s)},[a("div",ba,[o(U,{src:s.image_url||"",fit:"cover"},{error:l(()=>[a("div",Sa,[o(f,null,{default:l(()=>[o(J)]),_:1})])]),_:2},1032,["src"])]),a("div",Ta,[a("div",za,u(s.name),1),a("div",{class:qe(["window-status",{closed:!e.isWindowOpen(s)}])},[e.isWindowOpen(s)?(m(),ce(f,{key:0},{default:l(()=>[o(re)]),_:1})):(m(),ce(f,{key:1},{default:l(()=>[o(de)]),_:1})),a("span",null,u(e.isWindowOpen(s)?"营业中":"已打烊"),1)],2),a("div",La,[o(f,null,{default:l(()=>[o(q)]),_:1}),a("span",null,u(s.operatingHours),1)]),s.description?(m(),y("div",Wa,u(s.description),1)):Me("",!0)])],10,xa)}),128))]),a("div",Da,[a("div",Ma,[e.selectedWindow?(m(),y(E,{key:0},[e.isWindowOpen(e.selectedWindow)?(m(),y("div",Va,[o(K,{class:"window-info-card"},{default:l(()=>[a("div",Fa,[a("h3",null,u(e.selectedWindow.name),1),a("div",ja,[o(g,{size:"small",type:"success"},{default:l(()=>n[23]||(n[23]=[x("营业中")])),_:1}),o(g,{size:"small",type:"info"},{default:l(()=>[x(u(e.selectedWindow.operatingHours),1)]),_:1})])])]),_:1}),a("div",Pa,[o(ee,{modelValue:e.windowSearchQuery,"onUpdate:modelValue":n[5]||(n[5]=s=>e.windowSearchQuery=s),placeholder:"搜索当前窗口菜品",class:"filter-item",clearable:"",onInput:e.handleWindowSearch},{prefix:l(()=>[o(f,null,{default:l(()=>[o($)]),_:1})]),_:1},8,["modelValue","onInput"]),o(Z,{modelValue:e.selectedTaste,"onUpdate:modelValue":n[6]||(n[6]=s=>e.selectedTaste=s),placeholder:"选择口味",clearable:"",class:"filter-item",onChange:e.handleFilter},{default:l(()=>[(m(!0),y(E,null,A(e.tasteOptions,s=>(m(),ce(V,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),o(Z,{modelValue:e.sortOption,"onUpdate:modelValue":n[7]||(n[7]=s=>e.sortOption=s),placeholder:"排序方式",class:"filter-item",onChange:e.handleSort},{default:l(()=>[o(V,{label:"全部",value:""}),o(V,{label:"默认排序",value:"default"}),o(V,{label:"价格从低到高",value:"price-asc"}),o(V,{label:"价格从高到低",value:"price-desc"}),o(V,{label:"销量从高到低",value:"sales-desc"}),o(V,{label:"销量从低到高",value:"sales-asc"})]),_:1},8,["modelValue","onChange"])]),a("div",Oa,[(m(!0),y(E,null,A(e.dishCategories,s=>(m(),ce(g,{key:s,type:e.selectedCategory===s?"primary":"info",effect:"plain",class:"category-tag",onClick:T=>e.selectCategory(s)},{default:l(()=>[x(u(s),1)]),_:2},1032,["type","onClick"]))),128))]),a("div",Ea,[(m(!0),y(E,null,A(e.finalFilteredDishes,s=>(m(),y("div",{key:s.id,class:"dish-card",onClick:T=>e.goToDishDetail(s.id)},[a("div",Ia,[o(U,{src:s.image_url,class:"dish-image",fit:"cover"},{error:l(()=>[a("div",Aa,[o(f,null,{default:l(()=>[o(J)]),_:1})])]),_:2},1032,["src"]),a("div",qa,[a("div",Ra,[a("div",Ba,[a("h4",Ua,u(s.name),1),a("div",Ga,[o(g,{size:"small",effect:"plain",type:"info"},{default:l(()=>[x(u(s.windowName)+" · "+u(e.getFloorByWindowId(s.windowId))+"层 ",1)]),_:2},1024)])]),o(g,{size:"small",type:e.getCategoryType(s.category)||"info"},{default:l(()=>[x(u(s.category),1)]),_:2},1032,["type"])]),a("p",Na,u(s.description),1),a("div",Qa,[o(g,{size:"small",effect:"plain",type:e.getTasteTagType(s.taste)},{default:l(()=>[x(u(e.getTasteLabel(s.taste)),1)]),_:2},1032,["type"]),o(g,{size:"small",effect:"plain",type:s.stock>0?"success":"danger"},{default:l(()=>[x(u(s.stock>0?`库存: ${s.stock}`:"已售罄"),1)]),_:2},1032,["type"]),o(g,{size:"small",effect:"plain",type:"warning"},{default:l(()=>[x(" 周销量: "+u(s.weekSales),1)]),_:2},1024)]),a("div",Ya,[a("div",Xa,[n[24]||(n[24]=a("span",{class:"price-symbol"},"¥",-1)),a("span",Za,u(s.price.toFixed(2)),1)]),o(k,{type:"primary",size:"small",class:"add-button",disabled:s.stock===0,onClick:Je(T=>e.addToCart(s),["stop"])},{default:l(()=>[o(f,null,{default:l(()=>[o(ae)]),_:1})]),_:2},1032,["disabled","onClick"])])])])],8,Ha))),128))])])):(m(),y("div",Ja,[o(oe,{description:"该窗口暂无菜品","image-size":200},{description:l(()=>[a("div",Ka,[a("h3",$a,u(e.selectedWindow.name),1),a("p",es,u(e.isWindowOpen(e.selectedWindow)?"营业中":"已打烊"),1),a("p",ts,"营业时间："+u(e.selectedWindow.operatingHours),1),n[25]||(n[25]=a("p",{class:"empty-hint"},"建议您选择其他窗口",-1))])]),default:l(()=>[o(k,{type:"primary",onClick:n[8]||(n[8]=s=>e.selectedWindow=null)},{default:l(()=>n[26]||(n[26]=[x("返回选择")])),_:1})]),_:1})]))],64)):(m(),y("div",os,[o(oe,{description:"请选择窗口","image-size":200},{description:l(()=>[a("div",as,[n[27]||(n[27]=a("p",{class:"empty-hint"},"从左侧选您感兴趣的窗口",-1)),a("p",ss,"当前层共有 "+u(e.displayWindows.length)+" 个窗口可选",1)])]),_:1})]))])])])):(m(),y("div",la,[a("div",ia,[(m(!0),y(E,null,A(e.finalFilteredAllDishes,s=>(m(),y("div",{key:s.id,class:"dish-card",onClick:T=>e.goToDishDetail(s.id)},[a("div",ra,[o(U,{src:s.image_url,class:"dish-image",fit:"cover"},{error:l(()=>[a("div",da,[o(f,null,{default:l(()=>[o(J)]),_:1})])]),_:2},1032,["src"]),a("div",ua,[a("div",pa,[a("div",ma,[a("h4",_a,u(s.name),1),a("div",fa,[o(g,{size:"small",effect:"plain",type:"info"},{default:l(()=>[x(u(s.windowName)+" · "+u(e.getFloorByWindowId(s.windowId))+"层 ",1)]),_:2},1024)])]),o(g,{size:"small",type:e.getCategoryType(s.category)},{default:l(()=>[x(u(s.category),1)]),_:2},1032,["type"])]),a("p",ha,u(s.description),1),a("div",va,[o(g,{size:"small",effect:"plain",type:e.getTasteTagType(s.taste)},{default:l(()=>[x(u(e.getTasteLabel(s.taste)),1)]),_:2},1032,["type"]),o(g,{size:"small",effect:"plain",type:s.stock>0?"success":"danger"},{default:l(()=>[x(u(s.stock>0?`库存: ${s.stock}`:"已售罄"),1)]),_:2},1032,["type"]),o(g,{size:"small",effect:"plain",type:"warning"},{default:l(()=>[x(" 周销量: "+u(s.weekSales),1)]),_:2},1024)]),a("div",ga,[a("div",wa,[n[22]||(n[22]=a("span",{class:"price-symbol"},"¥",-1)),a("span",ya,u(s.price.toFixed(2)),1)]),o(k,{type:"primary",size:"small",class:"add-button",disabled:s.stock===0,onClick:Je(T=>e.addToCart(s),["stop"])},{default:l(()=>[o(f,null,{default:l(()=>[o(ae)]),_:1})]),_:2},1032,["disabled","onClick"])])])])],8,ca))),128))])]))])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue","onTabClick"])]),o(L,{modelValue:e.checkoutDialogVisible,"onUpdate:modelValue":n[14]||(n[14]=p=>e.checkoutDialogVisible=p),title:"确认订单",width:"400px"},{footer:l(()=>[o(k,{onClick:n[13]||(n[13]=p=>e.checkoutDialogVisible=!1)},{default:l(()=>n[31]||(n[31]=[x("取消")])),_:1}),o(k,{type:"primary",onClick:e.submitOrder},{default:l(()=>n[32]||(n[32]=[x("提交订单")])),_:1},8,["onClick"])]),default:l(()=>[a("div",ns,[a("div",ls,[(m(!0),y(E,null,A(e.cartItems,p=>(m(),y("div",{key:p.id,class:"checkout-item"},[a("span",is,u(p.name),1),a("span",cs,"x"+u(p.quantity),1),a("span",rs,"¥"+u(p.price*p.quantity),1)]))),128))]),o(pe),a("div",ds,[o(S,{model:e.checkoutForm,rules:e.checkoutRules,ref:"checkoutFormRef"},{default:l(()=>[o(w,{label:"就餐时间",prop:"diningTime"},{default:l(()=>[o(d,{modelValue:e.checkoutForm.diningTime,"onUpdate:modelValue":n[10]||(n[10]=p=>e.checkoutForm.diningTime=p),"picker-options":{start:"10:30",step:"00:15",end:"20:00"},placeholder:"选就餐时间"},null,8,["modelValue"])]),_:1}),o(w,{label:"就餐方式",prop:"diningType"},{default:l(()=>[o(z,{modelValue:e.checkoutForm.diningType,"onUpdate:modelValue":n[11]||(n[11]=p=>e.checkoutForm.diningType=p)},{default:l(()=>[o(C,{label:"dine_in"},{default:l(()=>n[28]||(n[28]=[x("堂食")])),_:1}),o(C,{label:"take_out"},{default:l(()=>n[29]||(n[29]=[x("打包")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o(w,{label:"备注",prop:"remark"},{default:l(()=>[o(ee,{modelValue:e.checkoutForm.remark,"onUpdate:modelValue":n[12]||(n[12]=p=>e.checkoutForm.remark=p),type:"textarea",placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),a("div",us,[n[30]||(n[30]=a("span",null,"合计:",-1)),a("span",ps,"¥"+u(e.totalPrice),1)])])]),_:1},8,["modelValue"])])])}const ws=Re(Mo,[["render",ms],["__scopeId","data-v-9debd53d"]]);export{ws as default};
