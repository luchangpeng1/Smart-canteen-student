import{aS as Y,O as Z,aT as J,aU as K,aV as $,L as ee,aN as le,aW as ne,aX as ae,W as oe,aM as te,Q as se,aY as ie,aZ as re,a_ as de,a$ as ue,b0 as ce,aC as me,g as f,h as x,i as l,d as a,w as t,t as c,E as r,aR as fe,f as s,b as g,l as d,F as D,j as L,k as ve,c as S,e as pe,G as _e,b1 as ge}from"./vendor-CyP8QNv9.js";import{_ as be}from"./index-DG4bgh5S.js";const ke={name:"UserProfile",components:{WalletFilled:Y,List:Z,StarFilled:J,ChatDotSquare:K,EditPen:$,Message:ee,Bell:le,Setting:ne,InfoFilled:ae,Plus:oe,ArrowRight:te,ChatSquare:se,Edit:ie,Medal:re,Document:de,Histogram:ue,Present:ce},setup(){const T=_e(),e=ge(),h=me(()=>{var n;try{return((n=e==null?void 0:e.getters)==null?void 0:n["user/userInfo"])||{name:"",studentId:"",avatar:"",balance:0,points:0,favorites:0,feedbacks:0,phone:"",email:""}}catch(u){return console.error("Failed to get user info:",u),{name:"",studentId:"",avatar:"",balance:0,points:0,favorites:0,feedbacks:0,phone:"",email:""}}}),o=async(n,u)=>{try{if(!e)throw new Error("Store is not initialized");return await e.dispatch(n,u)}catch(y){throw console.error(`Failed to dispatch ${n}:`,y),r.error("操作失败，请重试"),y}},B=f(!1),C=f({amount:50}),P=f(!1),w=f({canteen:"",window:"",type:"",content:"",images:[]}),i=[{id:1,name:"中央食堂"},{id:2,name:"沁园餐厅"}],v=n=>[{id:1,name:"特色炒菜"},{id:2,name:"食档口"}],A=()=>{B.value=!0},N=async()=>{if(!C.value.amount||C.value.amount<=0){r.warning("请输入有效的充值金额");return}try{await o("user/updateBalance",h.value.balance+C.value.amount),r.success(`成功充值 ${C.value.amount} 元`),B.value=!1}catch{}},p=()=>{P.value=!0},W=n=>{w.value.images.push(n)},q=()=>{if(!w.value.type){r.warning("请选择建议类型");return}if(!w.value.content||w.value.content.trim()===""){r.warning("请填写建议内容");return}r.success("感谢您的建议，我们会认真考虑"),P.value=!1,w.value={canteen:"",window:"",type:"",content:"",images:[]}},z=()=>{r({message:"校园食堂点餐系统 v1.0.0",type:"info"})},j=async()=>{try{await fe.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await o("user/logout"),r.success("已退出登录"),T.replace({path:"/login",query:{t:Date.now()}})}catch(n){n!=="cancel"&&(console.error("退出登录失败:",n),r.error("退出失败，请重试"))}},_=n=>{try{const u=n.startsWith("/")?n:`/student/${n}`;console.log("Navigating to:",u),T.push(u).catch(y=>{y.name!=="NavigationDuplicated"&&(console.error("Navigation error:",y),r.error("页面跳转失败"))})}catch(u){console.error("Navigation setup error:",u),r.error("页面跳转失败")}},H=n=>{try{switch(n){case"wallet":_("wallet");break;case"transactions":_("transactions");break;case"favorites":_("favorites");break;case"reviews":_("reviews");break;case"notification-settings":_("notification-settings");break;case"preferences":_("preferences");break;case"my-feedbacks":_("feedback-list");break;case"points":_("points-history");break;default:console.warn(`未处理的菜单命令: ${n}`);break}}catch(u){console.error("Menu click error:",u),r.error("操作失败")}},I=f(!1),b=f({avatar:"",name:"",phone:"",email:""}),O=f({name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]}),E=f(null),F=f(!1),G=()=>{b.value={avatar:h.value.avatar,name:h.value.name,phone:h.value.phone||"",email:h.value.email||""},I.value=!0},m=n=>{const u=n.raw.type.startsWith("image/"),y=n.raw.size/1024/1024<2;if(!u){r.error("只能上传图片文件!");return}if(!y){r.error("图片大小不能超过 2MB!");return}b.value.avatar=URL.createObjectURL(n.raw)},U=async()=>{if(E.value)try{await E.value.validate(),F.value=!0,await o("user/updateUserInfo",{...h.value,avatar:b.value.avatar,name:b.value.name,phone:b.value.phone,email:b.value.email}),r.success("个人信息更新成功"),I.value=!1}catch(n){n.message!=="validation failed"&&(console.error("更新个人信息失败:",n),r.error("更新失败，请重试"))}finally{F.value=!1}},V=f(!1),k=f(!1),M=f([{id:1,name:"5元代金券",description:"可用于抵扣订单金额",points:500,image:"/images/voucher.png"},{id:2,name:"10元代金券",description:"可用于抵扣订单金额",points:1e3,image:"/images/voucher.png"},{id:3,name:"免配送费券",description:"单次订单免配送费",points:200,image:"/images/delivery.png"}]);return{userInfo:h,rechargeVisible:B,rechargeForm:C,feedbackVisible:P,feedbackForm:w,canteens:i,showRecharge:A,handleRecharge:N,showFeedbackDialog:p,handleImageChange:W,submitFeedback:q,showAbout:z,handleLogout:j,getWindows:v,navigateToPage:_,handleMenuClick:H,profileEditVisible:I,profileForm:b,showEditProfile:G,handleAvatarChange:m,updateProfile:U,profileFormRef:E,profileFormRules:O,isUpdatingProfile:F,pointsRulesVisible:V,pointsExchangeVisible:k,exchangeItems:M,showPointsRules:()=>{V.value=!0},showPointsExchange:()=>{k.value=!0},handleExchange:async n=>{try{await o("user/exchangePoints",{itemId:n.id,points:n.points}),r.success("兑换成功")}catch{}}}}},he={class:"user-profile-container"},we={class:"user-profile"},Ve={class:"user-info-card"},ye={class:"user-info"},Ce={class:"info-content"},Fe={class:"name-wrapper"},xe={class:"balance-info"},Pe={class:"amount"},Ie={class:"amount"},Ee={class:"menu-list"},Ue={class:"menu-icon"},Me={class:"menu-content"},Re={class:"menu-value"},Se={class:"menu-icon"},Be={class:"menu-content"},De={class:"menu-icon"},Le={class:"menu-content"},Te={class:"menu-value"},Ae={class:"menu-icon"},Ne={class:"menu-content"},We={class:"menu-icon"},qe={class:"menu-content"},ze={class:"menu-icon"},je={class:"menu-content"},He={class:"menu-value"},Oe={class:"menu-icon"},Ge={class:"menu-content"},Qe={class:"menu-icon"},Xe={class:"menu-content"},Ye={class:"menu-icon"},Ze={class:"menu-content"},Je={class:"menu-icon"},Ke={class:"menu-content"},$e={class:"menu-icon"},el={class:"menu-content"},ll={class:"menu-icon"},nl={class:"menu-content"},al={class:"menu-value"},ol={class:"points"},tl={class:"logout-button"},sl={class:"recharge-options"},il=["onClick"],rl=["src"],dl={class:"exchange-list"},ul={class:"exchange-content"},cl=["src","alt"],ml={class:"exchange-info"},fl={class:"exchange-points"},vl={class:"points-value"};function pl(T,e,h,o,B,C){const P=s("el-avatar"),w=s("Edit"),i=s("el-icon"),v=s("el-button"),A=s("WalletFilled"),N=s("List"),p=s("ArrowRight"),W=s("StarFilled"),q=s("ChatDotSquare"),z=s("EditPen"),j=s("Message"),_=s("Bell"),H=s("Setting"),I=s("InfoFilled"),b=s("Histogram"),O=s("Document"),E=s("Present"),F=s("el-card"),G=s("el-input-number"),m=s("el-form-item"),U=s("el-form"),V=s("el-dialog"),k=s("el-option"),M=s("el-select"),R=s("el-input"),Q=s("Plus"),X=s("el-upload");return g(),x("div",he,[l("div",we,[l("div",Ve,[l("div",ye,[a(P,{size:64,src:o.userInfo.avatar},{default:t(()=>[d(c(o.userInfo.name.charAt(0)),1)]),_:1},8,["src"]),l("div",Ce,[l("div",Fe,[l("h3",null,c(o.userInfo.name),1),a(v,{class:"edit-btn",type:"primary",link:"",onClick:o.showEditProfile,title:"编辑个人信息"},{default:t(()=>[a(i,null,{default:t(()=>[a(w)]),_:1}),e[30]||(e[30]=l("span",{class:"edit-text"},"编辑资料",-1))]),_:1},8,["onClick"])]),l("p",null,c(o.userInfo.studentId),1)])]),l("div",xe,[l("div",{class:"balance-item",onClick:e[0]||(e[0]=n=>o.handleMenuClick("wallet")),style:{cursor:"pointer"}},[l("span",Pe,"¥"+c(o.userInfo.balance),1),e[31]||(e[31]=l("span",{class:"label"},"余额",-1))]),l("div",{class:"balance-item",onClick:e[1]||(e[1]=n=>o.navigateToPage("points-history")),style:{cursor:"pointer"}},[l("span",Ie,c(o.userInfo.points),1),e[32]||(e[32]=l("span",{class:"label"},"积分",-1))])])]),l("div",Ee,[a(F,{class:"menu-card"},{default:t(()=>[l("div",{class:"menu-item",onClick:e[2]||(e[2]=n=>o.handleMenuClick("wallet"))},[l("div",Ue,[a(i,null,{default:t(()=>[a(A)]),_:1})]),l("div",Me,[e[33]||(e[33]=l("span",null,"我的钱包",-1)),l("span",Re,"¥"+c(o.userInfo.balance),1)])]),l("div",{class:"menu-item",onClick:e[3]||(e[3]=n=>o.navigateToPage("transactions"))},[l("div",Se,[a(i,null,{default:t(()=>[a(N)]),_:1})]),l("div",Be,[e[34]||(e[34]=l("span",null,"消费记录",-1)),a(i,null,{default:t(()=>[a(p)]),_:1})])]),l("div",{class:"menu-item",onClick:e[4]||(e[4]=n=>o.handleMenuClick("favorites"))},[l("div",De,[a(i,null,{default:t(()=>[a(W)]),_:1})]),l("div",Le,[e[35]||(e[35]=l("span",null,"我的收藏",-1)),l("span",Te,c(o.userInfo.favorites)+"个菜品",1)])]),l("div",{class:"menu-item",onClick:e[5]||(e[5]=n=>o.handleMenuClick("reviews"))},[l("div",Ae,[a(i,null,{default:t(()=>[a(q)]),_:1})]),l("div",Ne,[e[36]||(e[36]=l("span",null,"历史评价",-1)),a(i,null,{default:t(()=>[a(p)]),_:1})])]),l("div",{class:"menu-item",onClick:e[6]||(e[6]=(...n)=>o.showFeedbackDialog&&o.showFeedbackDialog(...n))},[l("div",We,[a(i,null,{default:t(()=>[a(z)]),_:1})]),l("div",qe,[e[37]||(e[37]=l("span",null,"提交建议",-1)),a(i,null,{default:t(()=>[a(p)]),_:1})])]),l("div",{class:"menu-item",onClick:e[7]||(e[7]=n=>o.handleMenuClick("my-feedbacks"))},[l("div",ze,[a(i,null,{default:t(()=>[a(j)]),_:1})]),l("div",je,[e[38]||(e[38]=l("span",null,"我的建议",-1)),l("span",He,c(o.userInfo.feedbacks)+"条",1)])]),l("div",{class:"menu-item",onClick:e[8]||(e[8]=n=>o.handleMenuClick("notification-settings"))},[l("div",Oe,[a(i,null,{default:t(()=>[a(_)]),_:1})]),l("div",Ge,[e[39]||(e[39]=l("span",null,"通知设置",-1)),a(i,null,{default:t(()=>[a(p)]),_:1})])]),l("div",{class:"menu-item",onClick:e[9]||(e[9]=n=>o.handleMenuClick("preferences"))},[l("div",Qe,[a(i,null,{default:t(()=>[a(H)]),_:1})]),l("div",Xe,[e[40]||(e[40]=l("span",null,"偏好设置",-1)),a(i,null,{default:t(()=>[a(p)]),_:1})])]),l("div",{class:"menu-item",onClick:e[10]||(e[10]=(...n)=>o.showAbout&&o.showAbout(...n))},[l("div",Ye,[a(i,null,{default:t(()=>[a(I)]),_:1})]),l("div",Ze,[e[41]||(e[41]=l("span",null,"关于我们",-1)),a(i,null,{default:t(()=>[a(p)]),_:1})])]),l("div",{class:"menu-item",onClick:e[11]||(e[11]=n=>o.navigateToPage("points-history"))},[l("div",Je,[a(i,null,{default:t(()=>[a(b)]),_:1})]),l("div",Ke,[e[42]||(e[42]=l("span",null,"积分历史",-1)),a(i,null,{default:t(()=>[a(p)]),_:1})])]),l("div",{class:"menu-item",onClick:e[12]||(e[12]=n=>o.navigateToPage("points-rules"))},[l("div",$e,[a(i,null,{default:t(()=>[a(O)]),_:1})]),l("div",el,[e[43]||(e[43]=l("span",null,"积分规则",-1)),a(i,null,{default:t(()=>[a(p)]),_:1})])]),l("div",{class:"menu-item",onClick:e[13]||(e[13]=n=>o.navigateToPage("points-exchange"))},[l("div",ll,[a(i,null,{default:t(()=>[a(E)]),_:1})]),l("div",nl,[e[45]||(e[45]=l("span",null,"积分兑换",-1)),l("div",al,[l("span",ol,c(o.userInfo.points),1),e[44]||(e[44]=d(" 积分可用 ")),a(i,null,{default:t(()=>[a(p)]),_:1})])])])]),_:1}),l("div",tl,[a(v,{type:"danger",plain:"",onClick:o.handleLogout},{default:t(()=>e[46]||(e[46]=[d("退出登录")])),_:1},8,["onClick"])])]),a(V,{modelValue:o.rechargeVisible,"onUpdate:modelValue":e[16]||(e[16]=n=>o.rechargeVisible=n),title:"余额充值",width:"90%"},{footer:t(()=>[a(v,{onClick:e[15]||(e[15]=n=>o.rechargeVisible=!1)},{default:t(()=>e[47]||(e[47]=[d("取消")])),_:1}),a(v,{type:"primary",onClick:o.handleRecharge},{default:t(()=>e[48]||(e[48]=[d("确认充值")])),_:1},8,["onClick"])]),default:t(()=>[l("div",sl,[(g(),x(D,null,L([20,50,100,200],n=>l("div",{key:n,class:ve(["recharge-option",{active:o.rechargeForm.amount===n}]),onClick:u=>o.rechargeForm.amount=n}," ¥"+c(n),11,il)),64))]),a(U,{model:o.rechargeForm,"label-width":"80px"},{default:t(()=>[a(m,{label:"其他金额"},{default:t(()=>[a(G,{modelValue:o.rechargeForm.amount,"onUpdate:modelValue":e[14]||(e[14]=n=>o.rechargeForm.amount=n),min:0,step:10},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(V,{modelValue:o.feedbackVisible,"onUpdate:modelValue":e[22]||(e[22]=n=>o.feedbackVisible=n),title:"提交建议",width:"90%"},{footer:t(()=>[a(v,{onClick:e[21]||(e[21]=n=>o.feedbackVisible=!1)},{default:t(()=>e[49]||(e[49]=[d("取消")])),_:1}),a(v,{type:"primary",onClick:o.submitFeedback},{default:t(()=>e[50]||(e[50]=[d("提交建议")])),_:1},8,["onClick"])]),default:t(()=>[a(U,{model:o.feedbackForm,"label-width":"80px"},{default:t(()=>[a(m,{label:"食堂"},{default:t(()=>[a(M,{modelValue:o.feedbackForm.canteen,"onUpdate:modelValue":e[17]||(e[17]=n=>o.feedbackForm.canteen=n),placeholder:"请选择食堂"},{default:t(()=>[(g(!0),x(D,null,L(o.canteens,n=>(g(),S(k,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o.feedbackForm.canteen?(g(),S(m,{key:0,label:"窗口"},{default:t(()=>[a(M,{modelValue:o.feedbackForm.window,"onUpdate:modelValue":e[18]||(e[18]=n=>o.feedbackForm.window=n),placeholder:"请选择窗口"},{default:t(()=>[(g(!0),x(D,null,L(o.getWindows(o.feedbackForm.canteen),n=>(g(),S(k,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):pe("",!0),a(m,{label:"建议类型"},{default:t(()=>[a(M,{modelValue:o.feedbackForm.type,"onUpdate:modelValue":e[19]||(e[19]=n=>o.feedbackForm.type=n),placeholder:"请选择建议类型"},{default:t(()=>[a(k,{label:"菜品建议",value:"dish"}),a(k,{label:"服务建议",value:"service"}),a(k,{label:"环境建议",value:"environment"}),a(k,{label:"其他建议",value:"other"})]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"建议内容"},{default:t(()=>[a(R,{modelValue:o.feedbackForm.content,"onUpdate:modelValue":e[20]||(e[20]=n=>o.feedbackForm.content=n),type:"textarea",rows:4,placeholder:"请详细描述您的建议..."},null,8,["modelValue"])]),_:1}),a(m,{label:"图片"},{default:t(()=>[a(X,{action:"#","list-type":"picture-card","auto-upload":!1,"on-change":o.handleImageChange},{default:t(()=>[a(i,null,{default:t(()=>[a(Q)]),_:1})]),_:1},8,["on-change"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(V,{modelValue:o.profileEditVisible,"onUpdate:modelValue":e[27]||(e[27]=n=>o.profileEditVisible=n),title:"编辑个人信息",width:"90%","close-on-click-modal":!1},{footer:t(()=>[a(v,{onClick:e[26]||(e[26]=n=>o.profileEditVisible=!1)},{default:t(()=>e[52]||(e[52]=[d("取消")])),_:1}),a(v,{type:"primary",onClick:o.updateProfile,loading:o.isUpdatingProfile},{default:t(()=>e[53]||(e[53]=[d(" 保存 ")])),_:1},8,["onClick","loading"])]),default:t(()=>[a(U,{ref:"profileFormRef",model:o.profileForm,rules:o.profileFormRules,"label-width":"80px"},{default:t(()=>[a(m,{label:"头像"},{default:t(()=>[a(X,{class:"avatar-uploader",action:"#","show-file-list":!1,"auto-upload":!1,"on-change":o.handleAvatarChange,accept:"image/*"},{default:t(()=>[o.profileForm.avatar?(g(),x("img",{key:0,src:o.profileForm.avatar,class:"avatar"},null,8,rl)):(g(),S(i,{key:1,class:"avatar-uploader-icon"},{default:t(()=>[a(Q)]),_:1}))]),_:1},8,["on-change"]),e[51]||(e[51]=l("div",{class:"upload-tip"},"支持 jpg、png 格式，大小不超过 2MB",-1))]),_:1}),a(m,{label:"姓名",prop:"name"},{default:t(()=>[a(R,{modelValue:o.profileForm.name,"onUpdate:modelValue":e[23]||(e[23]=n=>o.profileForm.name=n),maxlength:"20","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(m,{label:"手机号码",prop:"phone"},{default:t(()=>[a(R,{modelValue:o.profileForm.phone,"onUpdate:modelValue":e[24]||(e[24]=n=>o.profileForm.phone=n),maxlength:"11"},null,8,["modelValue"])]),_:1}),a(m,{label:"邮箱",prop:"email"},{default:t(()=>[a(R,{modelValue:o.profileForm.email,"onUpdate:modelValue":e[25]||(e[25]=n=>o.profileForm.email=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),a(V,{modelValue:o.pointsRulesVisible,"onUpdate:modelValue":e[28]||(e[28]=n=>o.pointsRulesVisible=n),title:"积分规则",width:"90%"},{default:t(()=>e[54]||(e[54]=[l("div",{class:"points-rules"},[l("h4",null,"获取积分"),l("ul",null,[l("li",null,[d("完成订单："),l("span",{class:"points-value"},"+2分")]),l("li",null,[d("评价订单："),l("span",{class:"points-value"},"+3分")]),l("li",null,[d("首次使用："),l("span",{class:"points-value"},"+10分")]),l("li",null,[d("每日签到："),l("span",{class:"points-value"},"+1分")])]),l("h4",null,"积分等级"),l("ul",null,[l("li",null,"普通会员：0-100分"),l("li",null,"白银会员：101-500分"),l("li",null,"黄金会员：501-1000分"),l("li",null,"钻石会员：1000分以上")]),l("h4",null,"会员特权"),l("ul",null,[l("li",null,"白银会员：订单享95折"),l("li",null,"黄金会员：订单享9折"),l("li",null,"钻石会员：订单享85折")])],-1)])),_:1},8,["modelValue"]),a(V,{modelValue:o.pointsExchangeVisible,"onUpdate:modelValue":e[29]||(e[29]=n=>o.pointsExchangeVisible=n),title:"积分兑换",width:"90%"},{default:t(()=>[l("div",dl,[(g(!0),x(D,null,L(o.exchangeItems,n=>(g(),S(F,{key:n.id,class:"exchange-item"},{default:t(()=>[l("div",ul,[l("img",{src:n.image,alt:n.name,class:"exchange-image"},null,8,cl),l("div",ml,[l("h3",null,c(n.name),1),l("p",null,c(n.description),1),l("div",fl,[e[55]||(e[55]=d(" 需要 ")),l("span",vl,c(n.points),1),e[56]||(e[56]=d(" 积分 "))])])]),a(v,{type:"primary",onClick:u=>o.handleExchange(n),disabled:o.userInfo.points<n.points},{default:t(()=>e[57]||(e[57]=[d(" 立即兑换 ")])),_:2},1032,["onClick","disabled"])]),_:2},1024))),128))])]),_:1},8,["modelValue"])])])}const bl=be(ke,[["render",pl],["__scopeId","data-v-70e239c6"]]);export{bl as default};
