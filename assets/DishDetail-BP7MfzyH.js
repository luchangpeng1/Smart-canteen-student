import{b2 as Y,az as Z,W as $,M as ee,ax as te,b3 as se,bc as oe,bb as ae,bf as le,bg as ie,g as u,aD as re,b6 as ne,bh as de,o as ce,h as k,d as o,w as a,E as m,f as i,b as p,i as s,t as d,l as _,c as W,e as I,k as me,F as j,j as G,u as ue,G as _e}from"./vendor-CyP8QNv9.js";import"./request-DTHdL8ze.js";import{_ as ge}from"./index-DG4bgh5S.js";const pe={name:"DishDetail",components:{ArrowLeft:Y,ShoppingCart:Z,Plus:$,Loading:ee,Picture:te,Star:se,Share:oe,ChatDotRound:ae,Promotion:le,Link:ie},setup(){const z=ue(),e=_e(),S=u({}),t=u(!1),w=u(null),h=u([]),g=u(0),V=u(!0),n=u(!1),c=u(!1),F=re({reservedTime:"",mealType:"dine_in",quantity:1}),L={reservedTime:[{required:!0,message:"请选择就餐时间",trigger:"change"}],mealType:[{required:!0,message:"请选择就餐方式",trigger:"change"}],quantity:[{required:!0,message:"请选择数量",trigger:"change"}]},f=u(0);ne(g,r=>{f.value=Number(r)});const C=async()=>{try{await Promise.all([R(),q()])}catch{m.error("加载数据失败")}finally{V.value=!1}},R=async()=>{try{const r={id:z.params.id,name:"麻婆豆腐",price:15.8,description:"使用特级郫县豆瓣酱，搭配嫩滑豆腐，口感麻辣鲜香。选用上等猪肉末，配以青葱点缀，是一道经典的川菜。",category:"川菜",taste:"spicy",image_url:"https://images.unsplash.com/photo-1582476693547-81b4bd1af22e?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",stock:28,monthSales:342,weekSales:89,daySales:12,rating:4.8,ingredients:["嫩豆腐","猪肉末","郫县豆瓣酱","青葱","花椒","干辣椒"],nutritionFacts:{calories:287,protein:"15g",carbohydrates:"8.5g",fat:"22g"},cookingTime:"15分钟",spicyLevel:3,isSignatureDish:!0,tags:["热销","招牌菜","川菜经典"]};S.value=r}catch(r){console.error("获取菜品数据失败:",r),m.error("获取菜品数据失败")}},q=async()=>{try{h.value=[{id:1,userName:"张三",userAvatar:"https://avatars.githubusercontent.com/u/1?v=4",rating:5,content:"这道麻婆豆腐真的太好吃了！麻辣鲜香，豆腐嫩滑，肉末的咸香和辣椒的麻辣完美融合。特别喜欢这个口味，以后还会经常点！",createTime:"2024-03-15 12:30",images:["https://images.unsplash.com/photo-1582476693547-81b4bd1af22e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60","https://images.unsplash.com/photo-1582476693547-81b4bd1af22e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60"]},{id:2,userName:"李四",userAvatar:"https://avatars.githubusercontent.com/u/2?v=4",rating:4,content:"味道不错，就是有点辣。豆腐很嫩，肉末也很新鲜。建议可以让顾客选择辣度。",createTime:"2024-03-14 18:45"},{id:3,userName:"小王",userAvatar:"https://avatars.githubusercontent.com/u/3?v=4",rating:5,content:"学校食堂的麻婆豆腐竟然这么正宗！价格也很实惠，份量足够。特别喜欢这个咸鲜味，下饭神器！",createTime:"2024-03-14 12:15",images:["https://images.unsplash.com/photo-1582476693547-81b4bd1af22e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60"]},{id:4,userName:"美食达人",userAvatar:"https://avatars.githubusercontent.com/u/4?v=4",rating:4,content:"整体来说是不错的，豆腐的口感很好，不过感觉辣度可以再重一点。期待下次能有更多惊喜！",createTime:"2024-03-13 19:20"},{id:5,userName:"校园吃货",userAvatar:"https://avatars.githubusercontent.com/u/5?v=4",rating:5,content:"这道麻婆豆腐绝对是食堂的招牌！每次来都必点，从来没有失望过。豆腐很新鲜，酱料的比例也刚刚好。",createTime:"2024-03-13 13:40",images:["https://images.unsplash.com/photo-1582476693547-81b4bd1af22e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60","https://images.unsplash.com/photo-1582476693547-81b4bd1af22e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60","https://images.unsplash.com/photo-1582476693547-81b4bd1af22e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60"]}];const r=h.value.reduce((b,y)=>b+y.rating,0);g.value=(r/h.value.length).toFixed(1)}catch(r){console.error("获取评价失败:",r),m.error("获取评价失败")}},N=async()=>{if(w.value)try{await w.value.validate(),m.success("预订成功"),t.value=!1,e.push("/student/orders")}catch(r){console.error("预订失败:",r),m.error("预订失败")}},A=async()=>{try{m.success("已添加到购物车")}catch(r){console.error("添加购物车失败:",r),m.error("添加购物车失败")}},x=r=>({spicy:"麻辣",light:"清淡",sweet:"甜味",savory:"咸鲜"})[r]||r;de((r,b,y)=>{r.name==="DishList"&&localStorage.setItem("isReturningFromDetail","true"),y()});const T=()=>{localStorage.setItem("isReturningFromDetail","true"),e.back()},P=async()=>{try{n.value=!n.value,m.success(n.value?"收藏成功":"已取消收藏")}catch{m.error("操作失败")}},U=()=>{const r=window.location.href;navigator.clipboard.writeText(r),m.success("链接已复制"),c.value=!1},B=()=>{c.value=!0},v=()=>{m.success("已打开微信分享"),c.value=!1},D=()=>{m.success("已打开微博分享"),c.value=!1};return ce(()=>{C()}),{dish:S,orderDialogVisible:t,orderForm:F,orderFormRef:w,orderRules:L,showOrderDialog:()=>{t.value=!0},submitOrder:N,addToCart:A,getTasteLabel:x,goBack:T,reviews:h,averageRating:g,ratingValue:f,loading:V,isFavorite:n,shareDialogVisible:c,toggleFavorite:P,copyLink:U,showShareMenu:B,shareToWeChat:v,shareToWeibo:D}}},he={class:"dish-detail"},fe={class:"skeleton-content"},ve={style:{padding:"20px"}},be={class:"back-button"},ye={class:"back-content"},ke={class:"dish-banner"},we={class:"image-placeholder"},Ve={class:"image-placeholder"},Ce={class:"banner-overlay"},xe={class:"dish-title"},Te={class:"tags"},De={class:"info-section"},Se={class:"price-section"},Fe={class:"price-amount"},Le={class:"sales-grid"},Re={class:"sales-item"},qe={class:"sales-number"},Ne={class:"sales-item"},Ae={class:"sales-number"},Pe={class:"sales-item"},Ue={class:"sales-number"},Be={class:"description-box"},Me={class:"description-text"},We={class:"action-buttons"},ze={class:"primary-actions"},Oe={class:"secondary-actions"},Ee={class:"reviews-header"},Ie={class:"review-stats"},je={class:"rating"},Ge={class:"review-count"},He={class:"reviews-list"},Je={class:"review-header"},Ke={class:"review-user-info"},Qe={class:"user-name"},Xe={class:"review-time"},Ye={class:"review-content"},Ze={key:0,class:"review-images"},$e={class:"share-options"};function et(z,e,S,t,w,h){const g=i("el-skeleton-item"),V=i("ArrowLeft"),n=i("el-icon"),c=i("el-button"),F=i("Loading"),L=i("Picture"),f=i("el-image"),C=i("el-tag"),R=i("ShoppingCart"),q=i("Plus"),N=i("Star"),A=i("Share"),x=i("el-card"),T=i("el-rate"),P=i("el-empty"),U=i("el-avatar"),B=i("el-time-select"),v=i("el-form-item"),D=i("el-radio"),r=i("el-radio-group"),b=i("el-input-number"),y=i("el-form"),O=i("el-dialog"),H=i("ChatDotRound"),J=i("Promotion"),K=i("Link"),Q=i("el-skeleton");return p(),k("div",he,[o(Q,{loading:t.loading,animated:""},{template:a(()=>[s("div",fe,[o(g,{variant:"image",style:{width:"100%",height:"400px"}}),s("div",ve,[o(g,{variant:"h1",style:{width:"50%"}}),o(g,{variant:"text",style:{"margin-top":"16px"}}),o(g,{variant:"text",style:{width:"80%"}})])])]),default:a(()=>[s("div",be,[o(c,{onClick:t.goBack,class:"custom-back-btn",link:""},{default:a(()=>[s("div",ye,[o(n,{class:"back-icon"},{default:a(()=>[o(V)]),_:1}),e[10]||(e[10]=s("span",{class:"back-text"},"返回上一页",-1))])]),_:1},8,["onClick"])]),o(x,{class:"main-card","body-style":{padding:"0px"}},{default:a(()=>[s("div",ke,[o(f,{src:t.dish.image_url,alt:t.dish.name,fit:"cover","preview-src-list":[t.dish.image_url],"initial-index":0,class:"banner-image",loading:"lazy"},{placeholder:a(()=>[s("div",we,[o(n,{class:"is-loading"},{default:a(()=>[o(F)]),_:1})])]),error:a(()=>[s("div",Ve,[o(n,null,{default:a(()=>[o(L)]),_:1}),e[11]||(e[11]=s("span",null,"暂无图片",-1))])]),_:1},8,["src","alt","preview-src-list"]),s("div",Ce,[s("h1",xe,d(t.dish.name),1),s("div",Te,[o(C,{effect:"dark",class:"tag-item"},{default:a(()=>[_(d(t.dish.category),1)]),_:1}),t.dish.taste?(p(),W(C,{key:0,type:"success",effect:"dark",class:"tag-item"},{default:a(()=>[_(d(t.getTasteLabel(t.dish.taste)),1)]),_:1})):I("",!0)])])]),s("div",De,[s("div",Se,[e[12]||(e[12]=s("span",{class:"price-symbol"},"¥",-1)),s("span",Fe,d(t.dish.price),1),s("span",{class:me(["stock-tag",{"out-of-stock":t.dish.stock===0}])},d(t.dish.stock>0?`库存: ${t.dish.stock}`:"已售罄"),3)]),s("div",Le,[s("div",Re,[s("div",qe,d(t.dish.monthSales||0),1),e[13]||(e[13]=s("div",{class:"sales-label"},"月销量",-1))]),e[16]||(e[16]=s("div",{class:"sales-divider"},null,-1)),s("div",Ne,[s("div",Ae,d(t.dish.weekSales||0),1),e[14]||(e[14]=s("div",{class:"sales-label"},"周销量",-1))]),e[17]||(e[17]=s("div",{class:"sales-divider"},null,-1)),s("div",Pe,[s("div",Ue,d(t.dish.daySales||0),1),e[15]||(e[15]=s("div",{class:"sales-label"},"日销量",-1))])]),s("div",Be,[s("p",Me,d(t.dish.description),1)]),s("div",We,[s("div",ze,[o(c,{type:"primary",class:"order-btn",onClick:t.showOrderDialog,disabled:t.dish.stock===0},{default:a(()=>[o(n,null,{default:a(()=>[o(R)]),_:1}),e[18]||(e[18]=_(" 立即预订 "))]),_:1},8,["onClick","disabled"]),o(c,{type:"success",class:"cart-btn",onClick:t.addToCart,disabled:t.dish.stock===0},{default:a(()=>[o(n,null,{default:a(()=>[o(q)]),_:1}),e[19]||(e[19]=_(" 加入购物车 "))]),_:1},8,["onClick","disabled"])]),s("div",Oe,[o(c,{type:t.isFavorite?"danger":"default",circle:"",onClick:t.toggleFavorite},{default:a(()=>[o(n,null,{default:a(()=>[o(N)]),_:1})]),_:1},8,["type","onClick"]),o(c,{type:"primary",circle:"",onClick:t.showShareMenu},{default:a(()=>[o(n,null,{default:a(()=>[o(A)]),_:1})]),_:1},8,["onClick"])])])])]),_:1}),o(x,{class:"reviews-card"},{header:a(()=>[s("div",Ee,[e[20]||(e[20]=s("h3",{class:"section-title"},"用户评价",-1)),s("div",Ie,[s("span",je,d(t.averageRating),1),o(T,{modelValue:t.ratingValue,"onUpdate:modelValue":e[0]||(e[0]=l=>t.ratingValue=l),disabled:"","show-score":"","text-color":"#ff9900","score-template":""},null,8,["modelValue"]),s("span",Ge,"("+d(t.reviews.length)+"条评价)",1)])])]),default:a(()=>[s("div",He,[t.reviews.length?(p(!0),k(j,{key:1},G(t.reviews,l=>{var E;return p(),k("div",{key:l.id,class:"review-item"},[s("div",Je,[o(U,{size:50,src:l.userAvatar,class:"user-avatar"},{default:a(()=>[_(d(l.userName.charAt(0)),1)]),_:2},1032,["src"]),s("div",Ke,[s("span",Qe,d(l.userName),1),o(T,{modelValue:l.rating,"onUpdate:modelValue":M=>l.rating=M,disabled:"","show-score":"","text-color":"#ff9900"},null,8,["modelValue","onUpdate:modelValue"]),s("span",Xe,d(l.createTime),1)])]),s("div",Ye,d(l.content),1),(E=l.images)!=null&&E.length?(p(),k("div",Ze,[(p(!0),k(j,null,G(l.images,(M,X)=>(p(),W(f,{key:X,src:M,"preview-src-list":l.images,fit:"cover",class:"review-image"},null,8,["src","preview-src-list"]))),128))])):I("",!0)])}),128)):(p(),W(P,{key:0,description:"暂无评价","image-size":200}))])]),_:1}),o(O,{title:"预订菜品",modelValue:t.orderDialogVisible,"onUpdate:modelValue":e[5]||(e[5]=l=>t.orderDialogVisible=l),width:"30%"},{footer:a(()=>[o(c,{onClick:e[4]||(e[4]=l=>t.orderDialogVisible=!1)},{default:a(()=>e[23]||(e[23]=[_("取消")])),_:1}),o(c,{type:"primary",onClick:t.submitOrder},{default:a(()=>e[24]||(e[24]=[_("确认预订")])),_:1},8,["onClick"])]),default:a(()=>[o(y,{model:t.orderForm,rules:t.orderRules,ref:"orderFormRef"},{default:a(()=>[o(v,{label:"就餐时间",prop:"reservedTime"},{default:a(()=>[o(B,{modelValue:t.orderForm.reservedTime,"onUpdate:modelValue":e[1]||(e[1]=l=>t.orderForm.reservedTime=l),"picker-options":{start:"10:30",step:"00:15",end:"20:00"},placeholder:"选择就餐时间"},null,8,["modelValue"])]),_:1}),o(v,{label:"就餐方式",prop:"mealType"},{default:a(()=>[o(r,{modelValue:t.orderForm.mealType,"onUpdate:modelValue":e[2]||(e[2]=l=>t.orderForm.mealType=l)},{default:a(()=>[o(D,{label:"dine_in"},{default:a(()=>e[21]||(e[21]=[_("堂食")])),_:1}),o(D,{label:"take_out"},{default:a(()=>e[22]||(e[22]=[_("打包")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o(v,{label:"数量",prop:"quantity"},{default:a(()=>[o(b,{modelValue:t.orderForm.quantity,"onUpdate:modelValue":e[3]||(e[3]=l=>t.orderForm.quantity=l),min:1,max:t.dish.stock,step:1},null,8,["modelValue","max"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),o(O,{title:"分享菜品",modelValue:t.shareDialogVisible,"onUpdate:modelValue":e[9]||(e[9]=l=>t.shareDialogVisible=l),width:"300px"},{default:a(()=>[s("div",$e,[s("div",{class:"share-item",onClick:e[6]||(e[6]=(...l)=>t.shareToWeChat&&t.shareToWeChat(...l))},[o(n,null,{default:a(()=>[o(H)]),_:1}),e[25]||(e[25]=s("span",null,"微信",-1))]),s("div",{class:"share-item",onClick:e[7]||(e[7]=(...l)=>t.shareToWeibo&&t.shareToWeibo(...l))},[o(n,null,{default:a(()=>[o(J)]),_:1}),e[26]||(e[26]=s("span",null,"微博",-1))]),s("div",{class:"share-item",onClick:e[8]||(e[8]=(...l)=>t.copyLink&&t.copyLink(...l))},[o(n,null,{default:a(()=>[o(K)]),_:1}),e[27]||(e[27]=s("span",null,"复制链接",-1))])])]),_:1},8,["modelValue"])]),_:1},8,["loading"])])}const at=ge(pe,[["render",et],["__scopeId","data-v-3a490b24"]]);export{at as default};
