import{B as L}from"./BackHeader-CZHg4D0Q.js";import{au as d,g as S,aC as V,b6 as N,o as j,C as O,h as i,d as _,i as s,c as T,F as D,j as k,b1 as R,f as m,b as r,t as l,w as x,l as Y,e as B}from"./vendor-3y-Tr9ie.js";import{_ as z}from"./index-Cpc2chc0.js";d.locale("zh-cn");const U={name:"FeedbackList",components:{BackHeader:L},setup(){const g=R(),a=S([]),p=S(null),n=[{id:1,type:"dish",content:"建议增加水果种类",time:"2024-03-19 14:30",status:"replied",images:[],reply:"感谢您的建议,我们会考虑增加更多品种的水果",replyTime:"2024-03-19 15:00",canteen:"第一食堂",stall:"水果档口"},{id:2,type:"service",content:"希望能延长营业时间",time:"2024-03-18 20:00",status:"pending",images:[],reply:null,replyTime:null,canteen:"第二食堂",stall:"快餐窗口"}],y=V(()=>a.value.length);N(y,e=>{g.dispatch("user/updateFeedbacksCount",e)},{immediate:!0}),j(async()=>{a.value=n,g.dispatch("user/updateFeedbacksCount",n.length)}),O(()=>{});const b=[{text:"最近一周",value:()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-3600*1e3*24*7),[t,e]}},{text:"最近一个月",value:()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-3600*1e3*24*30),[t,e]}},{text:"最近三个月",value:()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-3600*1e3*24*90),[t,e]}}],h=V(()=>{const t=(p.value?a.value.filter(o=>{const c=d(o.time).format("YYYY-MM-DD");return c>=p.value[0]&&c<=p.value[1]}):a.value).reduce((o,c)=>{const f=d(c.time).format("YYYY-MM-DD");return o[f]||(o[f]=[]),o[f].push(c),o},{});return Object.entries(t).map(([o,c])=>({date:o,items:c})).sort((o,c)=>d(c.date).valueOf()-d(o.date).valueOf())});return{feedbacks:a,dateRange:p,dateShortcuts:b,groupedFeedbacks:h,formatDateLabel:e=>{const t=d().format("YYYY-MM-DD"),o=d().subtract(1,"day").format("YYYY-MM-DD");return e===t?"今天":e===o?"昨天":d(e).format("M月D日")},handleDateChange:e=>{p.value=e},getTypeTag:e=>({dish:"success",service:"warning",environment:"info",other:""})[e]||"",getTypeText:e=>({dish:"菜品建议",service:"服务建议",environment:"环境建议",other:"其他建议"})[e]||e,getStatusType:e=>({pending:"info",processing:"warning",replied:"success",closed:""})[e]||"",getStatusText:e=>({pending:"待处理",processing:"处理中",replied:"已回复",closed:"已关闭"})[e]||e,totalFeedbacks:y}}},E={class:"feedback-list"},H={class:"filter-section"},I={key:1,class:"feedback-items"},q={class:"date-divider"},A={class:"date-text"},G={class:"feedback-header"},J={class:"feedback-type"},K={class:"location-info"},P={class:"location-item"},Q={class:"location-item"},W={class:"time"},X={class:"feedback-content"},Z={class:"content-text"},$={key:0,class:"feedback-images"},ee={key:0,class:"feedback-reply"},te={class:"reply-content"},se={class:"reply-time"};function ae(g,a,p,n,y,b){const h=m("back-header"),w=m("el-date-picker"),C=m("el-empty"),v=m("el-tag"),M=m("el-image"),F=m("el-card");return r(),i("div",E,[_(h,{title:"我的建议"}),s("div",H,[_(w,{modelValue:n.dateRange,"onUpdate:modelValue":a[0]||(a[0]=u=>n.dateRange=u),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:n.dateShortcuts,onChange:n.handleDateChange,"value-format":"YYYY-MM-DD",class:"date-picker"},null,8,["modelValue","shortcuts","onChange"])]),n.groupedFeedbacks.length===0?(r(),T(C,{key:0,description:"暂无反馈记录"})):(r(),i("div",I,[(r(!0),i(D,null,k(n.groupedFeedbacks,u=>(r(),i("div",{key:u.date,class:"feedback-group"},[s("div",q,[s("span",A,l(n.formatDateLabel(u.date)),1)]),(r(!0),i(D,null,k(u.items,e=>(r(),T(F,{key:e.id,class:"feedback-card",shadow:"hover"},{default:x(()=>[s("div",G,[s("div",J,[_(v,{type:n.getTypeTag(e.type),class:"type-tag",effect:"dark"},{default:x(()=>[Y(l(n.getTypeText(e.type)),1)]),_:2},1032,["type"])]),_(v,{type:n.getStatusType(e.status),size:"small",class:"status-tag",effect:"plain"},{default:x(()=>[Y(l(n.getStatusText(e.status)),1)]),_:2},1032,["type"])]),s("div",K,[s("span",P,[a[1]||(a[1]=s("i",{class:"el-icon-location"},null,-1)),Y(" "+l(e.canteen),1)]),a[2]||(a[2]=s("span",{class:"location-divider"},"·",-1)),s("span",Q,l(e.stall),1),s("span",W,l(e.time),1)]),s("div",X,[s("p",Z,l(e.content),1),e.images.length?(r(),i("div",$,[(r(!0),i(D,null,k(e.images,(t,o)=>(r(),T(M,{key:o,src:t,"preview-src-list":e.images,fit:"cover",class:"feedback-image"},null,8,["src","preview-src-list"]))),128))])):B("",!0)]),e.reply?(r(),i("div",ee,[a[3]||(a[3]=s("div",{class:"reply-header"},[s("i",{class:"el-icon-chat-dot-round"}),s("span",{class:"reply-title"},"官方回复")],-1)),s("p",te,l(e.reply),1),s("p",se,l(e.replyTime),1)])):B("",!0)]),_:2},1024))),128))]))),128))]))])}const ce=z(U,[["render",ae],["__scopeId","data-v-71bec855"]]);export{ce as default};
