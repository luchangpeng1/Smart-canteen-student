import{b2 as A,as as R,aN as M,aP as P,aO as Q,g as O,o as z,C as E,h as _,i as e,d as o,w as r,aE as F,c as S,e as m,u as I,E as w,f as i,bi as j,b as d,t as a,l as p,F as J,j as U,G}from"./vendor-CyP8QNv9.js";import{_ as H}from"./index-DG4bgh5S.js";const K={name:"CurrentOrderDetail",components:{ArrowLeft:A,Timer:R,Bell:M,Ticket:P,QrcodeVue:Q},setup(){const h=I(),t=G(),k=O(!1),s=O({}),q=O(!1);let y=null;const N=async()=>{k.value=!0;try{const{status:n,createTime:u,canteenName:L,windowName:x,pickupLocation:D,totalAmount:B,dishes:l}=h.query;s.value={id:h.params.id,orderNumber:"ORD202403150001",status:n||"preparing",createTime:u||"2024-03-15 12:30:00",estimatedTime:"15",canteenName:L||"第一食堂",windowName:x||"特色炒菜",pickupLocation:D||"一楼3号窗口",totalAmount:Number(B)||45,dishes:l?JSON.parse(l):[{id:1,name:"宫保鸡丁",price:15,quantity:2,image_url:"https://example.com/dish1.jpg"},{id:2,name:"麻婆豆腐",price:15,quantity:1,image_url:"https://example.com/dish2.jpg"}]}}catch(n){console.error("获取订单详情失败:",n),w.error("获取订单详情失败")}finally{k.value=!1}},c=n=>({ordered:"已接单",preparing:"制作中",ready:"待取餐",cancelled:"已取消"})[n]||n,v=n=>({ordered:"info",preparing:"primary",ready:"success",cancelled:"info"})[n]||"",f=n=>({ordered:1,preparing:2,ready:3})[n]||0,T=()=>{q.value=!0},g=async()=>{try{await w.confirm("确定要取消这个订单吗？","提示",{type:"warning"}),w.success("订单已取消"),t.push("/student/orders")}catch(n){n!=="cancel"&&(console.error("取消订单失败:",n),w.error("取消订单失败"))}},C=()=>{t.push("/student/orders")},b=()=>{y=setInterval(async()=>{},1e4)},V=n=>JSON.stringify({orderId:n.id,orderNumber:n.orderNumber,timestamp:new Date().getTime()});return z(()=>{N(),["ordered","preparing"].includes(h.query.status)&&b()}),E(()=>{y&&clearInterval(y)}),{order:s,loading:k,qrDialogVisible:q,getStatusLabel:c,getStatusType:v,getProgressStep:f,showQRCode:T,cancelOrder:g,goBack:C,generateQRValue:V}}},W={class:"current-order-detail"},X={class:"back-button"},Y={class:"back-content"},Z={class:"detail-content"},$={class:"status-header"},ee={class:"order-info"},se={class:"order-number"},te={class:"order-time"},oe={class:"time-item"},ae={class:"value"},ne={class:"time-item"},re={class:"value"},ie={class:"location-info"},le={class:"info-item"},de={class:"value"},ce={key:0,class:"info-item"},_e={class:"value"},ue={key:0,class:"order-progress"},me={key:1,class:"waiting-time"},pe={key:2,class:"pickup-info"},ve={class:"pickup-header"},fe={class:"pickup-location"},ge={class:"card-header"},he={class:"window-name"},ke={class:"dishes-list"},ye={class:"dish-info"},be={class:"dish-name"},we={class:"dish-meta"},qe={class:"dish-price"},Ne={class:"dish-quantity"},Te={class:"dish-subtotal"},Ce={class:"price-summary"},Ve={class:"price-item"},Le={class:"price-item total"},xe={class:"final-price"},De={class:"action-buttons"},Be={class:"qr-dialog-content"},Oe={class:"qr-header"},Se={class:"window-info"},Ae={class:"canteen-name"},Re={class:"window-name"},Me={class:"pickup-location"},Pe={class:"order-info"},Qe={class:"order-time"},ze={class:"order-amount"},Ee={class:"qr-code-wrapper"},Fe={class:"qr-footer"},Ie={class:"qr-tip"},je={class:"validity-info"};function Je(h,t,k,s,q,y){const N=i("ArrowLeft"),c=i("el-icon"),v=i("el-button"),f=i("el-tag"),T=i("el-divider"),g=i("el-step"),C=i("el-steps"),b=i("Timer"),V=i("Bell"),n=i("Ticket"),u=i("el-card"),L=i("el-image"),x=i("qrcode-vue"),D=i("el-dialog"),B=j("loading");return d(),_("div",W,[e("div",X,[o(v,{onClick:s.goBack,class:"custom-back-btn",link:""},{default:r(()=>[e("div",Y,[o(c,{class:"back-icon"},{default:r(()=>[o(N)]),_:1}),t[1]||(t[1]=e("span",{class:"back-text"},"返回上一页",-1))])]),_:1},8,["onClick"])]),F((d(),_("div",Z,[o(u,{class:"status-card"},{default:r(()=>[e("div",$,[e("div",ee,[e("h2",se,"订单号："+a(s.order.orderNumber),1),o(f,{type:s.getStatusType(s.order.status),class:"status-tag",size:"large"},{default:r(()=>[p(a(s.getStatusLabel(s.order.status)),1)]),_:1},8,["type"])]),e("div",te,[e("div",oe,[t[2]||(t[2]=e("span",{class:"label"},"下单时间：",-1)),e("span",ae,a(s.order.createTime),1)]),e("div",ne,[t[3]||(t[3]=e("span",{class:"label"},"预计取餐时间：",-1)),e("span",re,a(s.order.estimatedPickupTime||"15分钟内"),1)])]),e("div",ie,[e("div",le,[t[4]||(t[4]=e("span",{class:"label"},"取餐位置：",-1)),e("span",de,[o(f,{size:"small",type:"info",class:"location-tag"},{default:r(()=>[p(a(s.order.canteenName),1)]),_:1}),o(T,{direction:"vertical"}),o(f,{size:"small",type:"primary",class:"location-tag"},{default:r(()=>[p(a(s.order.windowName),1)]),_:1})])]),s.order.pickupLocation?(d(),_("div",ce,[t[5]||(t[5]=e("span",{class:"label"},"取餐点：",-1)),e("span",_e,a(s.order.pickupLocation),1)])):m("",!0)])]),s.order.status!=="cancelled"?(d(),_("div",ue,[o(C,{active:s.getProgressStep(s.order.status),"finish-status":"success"},{default:r(()=>[o(g,{title:"已接单"}),o(g,{title:"制作中"}),o(g,{title:"待取餐"})]),_:1},8,["active"])])):m("",!0),s.order.status==="preparing"?(d(),_("div",me,[o(c,null,{default:r(()=>[o(b)]),_:1}),p(" 预计等待时间："+a(s.order.estimatedTime||"15")+"分钟 ",1)])):m("",!0),s.order.status==="ready"?(d(),_("div",pe,[e("div",ve,[o(c,null,{default:r(()=>[o(V)]),_:1}),t[6]||(t[6]=e("span",null,"您的餐品已准备就绪",-1))]),e("div",fe," 取餐点："+a(s.order.pickupLocation||"一楼取餐处"),1),o(v,{type:"success",class:"show-qr-btn",onClick:s.showQRCode},{default:r(()=>[o(c,null,{default:r(()=>[o(n)]),_:1}),t[7]||(t[7]=p(" 显示取餐码 "))]),_:1},8,["onClick"])])):m("",!0)]),_:1}),o(u,{class:"dishes-card"},{header:r(()=>[e("div",ge,[t[8]||(t[8]=e("h3",null,"菜品详情",-1)),e("span",he,a(s.order.windowName),1)])]),default:r(()=>[e("div",ke,[(d(!0),_(J,null,U(s.order.dishes,l=>(d(),_("div",{key:l.id,class:"dish-item"},[o(L,{src:l.image_url,alt:l.name,class:"dish-image"},{error:r(()=>t[9]||(t[9]=[e("div",{class:"image-placeholder"},"暂无图片",-1)])),_:2},1032,["src","alt"]),e("div",ye,[e("h4",be,a(l.name),1),e("div",we,[e("span",qe,"¥"+a(l.price),1),e("span",Ne,"× "+a(l.quantity),1)])]),e("div",Te," ¥"+a((l.price*l.quantity).toFixed(2)),1)]))),128))]),e("div",Ce,[e("div",Ve,[t[10]||(t[10]=e("span",null,"商品总额",-1)),e("span",null,"¥"+a(s.order.totalAmount),1)]),e("div",Le,[t[11]||(t[11]=e("span",null,"实付金额",-1)),e("span",xe,"¥"+a(s.order.totalAmount),1)])])]),_:1}),e("div",De,[s.order.status==="ordered"?(d(),S(v,{key:0,type:"danger",onClick:s.cancelOrder},{default:r(()=>t[12]||(t[12]=[p(" 取消订单 ")])),_:1},8,["onClick"])):m("",!0)])])),[[B,s.loading]]),o(D,{modelValue:s.qrDialogVisible,"onUpdate:modelValue":t[0]||(t[0]=l=>s.qrDialogVisible=l),title:"取餐码",width:"300px",center:"",class:"qr-dialog","show-close":!0,"close-on-click-modal":!1,modal:!1},{default:r(()=>[e("div",Be,[e("div",Oe,[e("div",Se,[e("span",Ae,a(s.order.canteenName),1),e("span",Re,a(s.order.windowName),1),e("span",Me,a(s.order.pickupLocation),1)]),e("div",Pe,[e("span",Qe,a(s.order.createTime),1),e("span",ze,"¥"+a(s.order.totalAmount.toFixed(2)),1)])]),e("div",Ee,[s.order?(d(),S(x,{key:0,value:s.generateQRValue(s.order),size:200,level:"H",class:"pickup-qr","render-as":"svg"},null,8,["value"])):m("",!0),t[13]||(t[13]=e("div",{class:"qr-border"},null,-1))]),e("div",Fe,[e("div",Ie,[o(c,null,{default:r(()=>[o(n)]),_:1}),t[14]||(t[14]=e("span",null,"请向取餐人员出示此码",-1))]),e("div",je,[o(c,null,{default:r(()=>[o(b)]),_:1}),t[15]||(t[15]=e("span",null,"有效期15分钟",-1))])])])]),_:1},8,["modelValue"])])}const He=H(K,[["render",Je],["__scopeId","data-v-05825aba"]]);export{He as default};
